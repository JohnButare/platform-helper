#!/usr/bin/env bash
. script.sh || exit

usage()
{
	ScriptUsage "$1" "\
Usage: $(ScriptName) [COMMAND]... [OPTION]...
Additional Apache web server functionality.
	
	log			show the log file
	dir			return directories

	-H, --host=HOST					host to use, default is the current host if Apache is running locally or the current active web server"
}

argStart() { unset -v host; }

opt()
{
	case "$1" in
		-H|--host|-H=*|--host=*) ScriptOptGet "host" "$@";;
		*) return 1;;
	esac
}

argEnd()
{
	[[ ! $host && ! -f "/etc/apache2/apache2.conf" ]] && host="$(GetServer "web")"
	return 0
}

#
# Dir Command
#

dirUsage()
{
	echot "Usage: $(ScriptName) dir [config|web](web)
Return the path to an Apache directory."
}

dirCommand() { dirWebCommand; }

dirConfigCommand() { getDir "/etc/apache2"; }
dirWebCommand() { getDir "/var/www/html"; }

#
# Log Command
#

logCommand()
{ 
	local dir; dir="$(getDir "/var/log/apache2/access.log")" || return
	LogShow "$dir"
} 


restartCommand() 
{ 
	local command=(service restart apache2)
	if [[ $host ]]; then ssh -t "$host" -- "${command[@]}"; else "${command[@]}"; fi
}

#
# helper
#

currentWebServer() { GetServer "web"; }

getDir()
{
	local dir="$1"
	if [[ $host ]]; then unc mount "//$host/admin$dir"; else echo "$dir"; fi
}

ScriptRun "$@"
