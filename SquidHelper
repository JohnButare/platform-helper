#!/usr/bin/env bash
. "${BASH_SOURCE[0]%/*}/function.sh" app script || exit

usage()
{
	ScriptUsage "$1" "\
Usage: $(ScriptName) check|hits|info|IsInstalled|IsRunning|log|restart|utilization|version
Additional Squid Server functionality."
}

hitsCommand() { grep "HIER_NONE" "$(getLogFile)"; }
infoCommand() { squidclient -h "$1" cache_object://localhost/ mgr:info; }
isInstalledCommand() { InPath squid; }
isRunningCommand() { IsProcessRunning "squid"; }
restartCommand() { sudo /etc/init.d/ProxyServer.sh restart; }
utilizationCommand() { squidclient -h "${1:-127.0.0.1}" cache_object://localhost/ mgr:utilization; }
versionCommand() { AppInstallCheck && squid -v | head -1 | ${G}cut -d" " -f4; }

#
# check command
#

checkUsage() { ScriptUsageEcho "Usage: $(ScriptName) check\nReturn true if the Squid proxy server is available."; }
checkCommand() { IsAvailablePort "$(ConfigGetCurrent "ProxyServer")" "${globalArgs[@]}"; }

#
# log command
#

logUsage() { ScriptUsageEcho "Usage: $(ScriptName) log [file]."; }
logCommand() { LogShow "$(SquidLogFile)"; }
logFileCommand() { getLogFile; }
getLogFile() { local file="/var/log/squid/access.log"; IsPlatform mac && file="$HOME/Library/Logs/squid/squid-access.log"; echo "$file"; }

ScriptRun "$@"
