#!/usr/bin/env bash
. function.sh || exit

# InstBak - backup all installation locations
run()
{
	local desc dirs src srcDesc fsUnc="$(ConfigGet "fsUnc")"

	src="$(unc mount public)/Documents/data/install" || return
	srcDesc="$(unc get unc "$src" | GetUncServer | RemoveDnsSuffix)"

	IFS=$'\n' dirs=( $(FindInstallFile --all) )

	for dir in "${dirs[@]}"; do
		
		if IsUncPath "$dir"; then
			desc="$(GetUncServer "$dir" | RemoveDnsSuffix)"
			[[ "$desc" == "$srcDesc" ]] && continue
			dir="$(unc mount "$dir")" || return

		elif drive IsDrive "$dir"; then
			desc="$(drive label "$dir")"; desc="${desc:-$dir}"

		else
			desc="local"

		fi
		
		header "$desc"
		CopyDir --recursive --delete "$src" "$dir" || return
		echo
	
	done
}

run "$@"
