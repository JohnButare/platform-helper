#!/bin/bash
. function.sh

SshEnv="$HOME/.ssh/environment"

function StartAgent
{
	echo -n "Initialising new SSH agent..."
	/usr/bin/ssh-agent | sed 's/^echo/#echo/' > "${SshEnv}"
	echo succeeded
	chmod 600 "${SshEnv}"
	. "${SshEnv}" > /dev/null
	/usr/bin/ssh-add;
}

Usage()
{
	echot "\
usage: SshAgent startup
"
	exit
}

function initializeCommand()
{
	[[ -f "${SshEnv}" ]] && echo "${SshEnv}"
}

function startupCommand()
{
	if [ -f "${SshEnv}" ]; then
		. "${SshEnv}" > /dev/null
		ps -ef | grep ${SSH_AGENT_PID} | grep ssh-agent$ > /dev/null || {
		    StartAgent;
		}
	else
		StartAgent;
	fi
}

{ [[ $# == 0 ]] || ! IsFunction ${1}Command; } && Usage
${1}Command ${@:2}
exit $?
