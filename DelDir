#!/usr/bin/env bash
. function.sh

usage()
{
	echot "\
usage: DelDir DIR
	Safely delete a directory
	-a, --ask				ask before deleting 
	-c, --contents	delete the contents
	-v, --verbose 	verbose output"
	exit $1
}

init() { :; }

args()
{
	unset ask contents dir verbose
	while [ "$1" != "" ]; do
		case "$1" in
			--ask|-a) ask="true";;
			--contents|-c) contents="true";;
			--help) IsFunction "${command}Usage" && ${command}Usage || usage 0;;
			--verbose|-v) verbose="true";;
			*)
				! IsOption "$1" && [[ ! $dir ]] && { dir="$1"; shift; continue; }
				UnknownOption "$1"
		esac
		shift
	done
	[[ ! $dir ]] && MissingOperand "dir"
	args=("$@")
}

run()
{	
	init; args "$@"; 
	delete "$dir"
}

delete()
{
	[[ ! -d "$dir" ]] && return
	
	if [[ $ask ]]; then
		local desc; [[ $contents ]] && desc=" the contents of"
		ask "Are you sure you want to delete$desc directory \"$dir\"" -dr n || return 1
	fi

	[[ $verbose ]] && printf "Deleting directory \"$dir\"..."
	[[ $contents ]]	&& { rm -fr "$dir/"* || return; } || { rm -fr "$dir" || return; }
	[[ $verbose ]] && echo "done"
	return 0
}

run "$@"
