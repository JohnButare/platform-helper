#!/usr/bin/env bash
. function.sh
# bootstrap-remote [REMOTE](pi@pi1) [USER]($USER) [HOST] - bootstrap a remote system

init()
{
	remote="${1:-pi@pi1}"
	user="${2:-$USER}"
	host="${3:-nas3.hagerman.butare.net}"
}

run()
{
	init "$@" || return
	configureSsh || return
	bootstrap || return
}

bootstrap()
{
	local file="bootstrap-init"
	local destFile="/tmp/$file"

	echo "Copying $file to $remote:$destFile..."
	scp "$BIN/$file" "$remote:$destFile" || return
	echo

	local clip="$destFile $user $host"
	echo "Execute the contents of the clipboard ($clip) on $remote..."
	clipw "$clip" || return
	ssh -t $remote || return
}

configureSsh()
{
	! ask 'Configure ssh' && return
	ssh $remote '[[ -d ~/.ssh ]] || mkdir ~/.ssh' || return
	scp ~/.ssh/* ''$remote':~/.ssh' || return
}

run "$@"
