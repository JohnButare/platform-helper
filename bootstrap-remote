#!/usr/bin/env bash
. function.sh

# Copy the platform specific bootstrap file from an existing system to a new remote system 
# that has SSH enabled.  This is useful for headless platforms with no GUI.

init()
{
	remote="${1:-pi@pi1}"
	platform="${2:-debian}"
	user="${3:-jjbutare}"
	host="${4:-nas1}"
}

run()
{
	init "$@" || return
	configureSsh || return
	bootstrap || return
}

bootstrap()
{
	local file="bootstrap-$platform"
	local destFile="/tmp/$file"

	echo "Copying $file to $remote:$destFile..."
	scp "$BIN/$file" "$remote:$destFile" || return
	echo

	echo "Execute the contents of the clipboard on $remote..."
	clipw "$destFile $user $host" || return
	ssh -t $remote || return
}

configureSsh()
{
	! ask 'Configure ssh' && return
	ssh $remote '[[ -d ~/.ssh ]] || mkdir ~/.ssh' || return
	scp ~/.ssh/* ''$remote':~/.ssh' || return
}

run "$@"
