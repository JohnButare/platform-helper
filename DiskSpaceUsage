#!/usr/bin/env bash
. app.sh || exit

run() {	init || return; startCommand "$@"; }

usage() {	echot "usage: DiskSpaceUsage DIR"; exit $1; }

init() 
{ 
	program=() start="start"
	
	if HasWindowManager; then

		case "$PLATFORM" in
			mac) program="$P/Disk Inventory X.app";;
			win) 
				if [[ -f "$P/WizTree/WizTree64.exe" ]]; then program="$P/WizTree/WizTree64.exe"
				else program="$DATA/platform/win/windirstat.exe"
				fi
		esac
		[[ -f "$program" ]] && return

		InPath qdirstat && { program="qdirstat"; return; }
		InPath baobab && { program="baobab"; return; }
	fi

	InPath ncdu && { program=( ncdu -x ); start=""; return; }
	InPath gt5 && { program="gt5"; start=""; return; }
	InPath duc && { program=( duc ui ); start=""; return; }
	InPath du && { program=( du -h ); start=""; return; }

	[[ ! $program ]] && { EchoErr "DiskSpaceUsage: no disk space utilization program was found"; return 1; }

	return 0
}

startCommand()
{
	local args=( "$@" ); [[ "${#args[@]}" == "0"  || "$1" == "." ]] && args="$PWD"

	$start "${program[@]}" "${args[@]}"
}

run "$@"