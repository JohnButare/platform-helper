#!/bin/bash
. bash.bashrc
. function.sh

run()
{
	init "$@" || return
	LinkAdAccount || return
	CopyCommonFiles || return
	InstallBootstrap || return
	InstallApps || return
}

init()
{
	computer="$1" install="$2"; shift 2; apps=( "$@" )
	[[ ! $computer ]] && MissingOperand "COMPUTER"
	[[ ! $install ]] && MissingOperand "INSTALL_DIR"
	! IsElevated && { EchoErr "bootstrap must be run as administrator"; return 1; }
	install="$(wtu "$install")"
}

LinkAdAccount()
{
	[[ ! "$USERNAME" =~ ^ad_ ]] && return
 	src="$USERS/${USERNAME#ad_}/Documents/data" link="$USERS/${USERNAME}/Documents/data"
 	mkdir --parents "$src" || return 1
	MakeLink "$src" "$link" || return 1
}

CopyCommonFiles()
{
	[[ -d "$PUB/Documents/data/bin" ]] && return
	SyncLocalFiles --src-older "$computer"
}


InstallBootstrap()
{
	inst --no-run-prompt --hint "$install" bootstrap
}

InstallApps()
{
	for app in "$apps"; do inst --no-run-prompt --hint "$install" "$app"; done	
}

run "$@"
