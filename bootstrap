#!/usr/bin/env bash
. function.sh

# bootstrap a generic system once the platform specific installation is done
# flow bootstrap-remote (optional) -> bootstrap-init -> boostrap -> inst bootstrap

init()
{
	host="$1"
	install="$2"
}

run()
{
	init "$@" || return
	RunPlatform bootstrap || return
	makeDir "/usr/local/data" || return
	SyncLocalFiles "$hostFiles" || return
	inst --quiet --no-prompt "$install" bootstrap || return
}

bootstrapWin()
{
	[[ $install ]] && { install="--hint \"$(wtu "$install")\""; }
	linkDir "$WIN_USERS/Public" "$PUB" || return
	linkDir "$WIN_USERS/Public/Documents/data" "$DATA" || return
	linkDir "$WIN_HOME/Documents" ~/Documents || return
	return 0
}

linkDir() # SRC LINK
{
	local src="$1" link="$2"
	[[ -L "$link" ]] && return
	sudo ${G}mkdir --parents "$src" || return
	sudo ln -s "$src" "$link" || return
}

makeDir()
{
	[[ ! -d "$1" ]] && { sudo ${G}mkdir --parents "$1" || return; }
	sudo chown $USER "$1" || return
}

run "$@"
