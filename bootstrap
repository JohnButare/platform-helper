#!/bin/bash
. bash.bashrc
. function.sh

run()
{
	init "$@" || return
	LinkAdAccount || return
	CopyCommonFiles || return
	InstallBootstrap || return
	InstallApps || return
}

init()
{
	computer="$1" install="$2"; shift 2; apps=( "$@" )
	[[ ! $computer ]] && MissingOperand "COMPUTER"
	[[ ! $install ]] && MissingOperand "INSTALL_DIR"
	! IsElevated && { EchoErr "bootstrap must be run as administrator"; return 1; }
	install="$(wtu "$install")"
}

LinkAdAccount()
{
	[[ ! "$USERNAME" =~ ^ad_ ]] && return
	local dir="$USERS/${USERNAME#ad_}"
 	LinkDir "$dir/Documents/data" "$USERS/${USERNAME}/Documents/data" || return
}

LinkDir() # SRC LINK
{
	mkdir --parents "$1" || return
	MakeLink "$1" "$2" || return
}

CopyCommonFiles()
{
	[[ -d "$PUB/Documents/data/bin" ]] && return
	SyncLocalFiles --src-older "$computer"
}


InstallBootstrap()
{
	inst --no-run-prompt --hint "$install" bootstrap
}

InstallApps()
{
	for app in "$apps"; do inst --no-run-prompt --hint "$install" "$app"; done	
}

run "$@"
