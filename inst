#!/usr/bin/env bash
. function.sh || exit

IsInstallable()
{
	case "$1" in	
		# Windows
		ahk|AutoHotKey|AltTabTerminator|AquaSnap|CloseAllWindows|FileLocatorPro|HiddenStart|Ninite|npp|Notepadpp|RightClickEnhancer|SevenZip|TidyTabs|UltraMon|vcxsrv|WinScp|xMing) IsPlatform win;;
		AjaSystemTest|BlueStacks|CPUZ|DiskImager|IntelExtremeTuning|LgMonitor|LxRunOffline|PartitionAssistant|pGina|PowerPanel|PowerrToys|QuickBooks|stamps|TaskLayout|Todoist|Wallpaper4k) IsPlatform win;;

		# Mac
		apptivate|bartender|CarrotWeather|iTerm|KarabinerElements|LiveDesktop|Magnet|pcalc|spark|speedtest|WallpaperWizard|XQuartz) IsPlatform mac;;
		DayOne|yoink) IsPlatform mac;;

		# Windows, Mac
		CanonCamera|CleanMyPc|Cricut|deezer|Domotz|DuetDisplay|GreenShot|JumpDesktop|LastPass|LogitechOptions|notion|office|origin|QnapExternalRaidManager|qvr|sonos|zoom) IsPlatform mac,win;;

		# Windows, Mac, Ubuntu
		bc|BeyondCompare|Dropbox|JumpCloud|StandardNotes|steam|sublime|SublimeMerge|TeamViewer|UniFiController) IsPlatform mac,ubuntu,win;;

		# other
		firefox|skype) IsPlatform debian,mac,win;;

		*) true;;
	esac

	return $?
}

TemplateInstall()
{
	printf "**************************************************\n* name\n**************************************************\n"

	# http://www.techsmith.com/download/licenses/snagitupgrade.asp
	run "TechSmith/SnagIt/setup/SnagIt V12.2.1." -p "win" "mac" "linux" || return

	if IsPlatform win; then
		$registry delete "run/ErmTray" # C:/Program Files/McAfee/Host Intrusion Prevention/FireTray.exe 
		mergeDir "$pp/(dir)" "$ao" || return
		mergeDir "$pp/(dir)" "$pp/Development/Other" || return
		$mv "$pp/Sublime Text 2.lnk" "$pp/Applications" || return
		$rm "$pd/(prog).lnk" || return
	fi

	return 0
}

TemplateAlias() { TemplateFullInstall; };
TemplateFullInstall()
{
	printf "**************************************************\n* name\n**************************************************\n"
	echot "- application information"

	local v="SnagIt V12.2.1." # http://www.techsmith.com/download/licenses/snagitupgrade.asp
	run "TechSmith/SnagIt/setup/$v" -p "win" "mac" "linux" || return

	local v="4.0.7.19761" # http://www.scootersoftware.com/beta.php
	run "Scooter Software/Beyond Compare/setup/" -p "BCompare-$v.exe" "BCompareOSX-$v.zip" "bcompare-$v_i386.deb" || return

	FindFile "Intel/Profile Manager/ProfileManager.xml" || return
	$cp	"$file" "$WINDIR/system32" || return
	$cpDir "$src" "$dest" || return

	if [[ "$PLATFORM" == "win" ]]; then	
		mergeDir "$pp/(dir)" "$pp/Development/Other" || return
		mergeDir "$pp/(dir)" "$ao" || return
		$rm "$pd/(prog).lnk" || return
		mergeDir --rename "$pp/(dir)" "$ao/(new name)" || return
		makeDir "$pp/Operating System/bash" || return
		$makeShortcut "$InstallDir/bin/bash.exe" "$pp/Operating System/bash" "-" || return
	
	elif [[ "$PLATFORM" == "mac" ]]; then	
		$rm "$la\com.adobe.AAM.Updater-1.0.plist" || return
		$rm "$la\com.adobe.AdobeCreativeCloud.plist" || return
		$rm "$ula\com.adobe.AAM.Updater-1.0.plist" || return

	fi

	makeLink --merge --hide "$udoc/code/web/sites" "$udoc/My Web Sites" || return

	$registry delete "run/ErmTray" # C:/Program Files/McAfee/Host Intrusion Prevention/FireTray.exe 
	$registry import "$install/AutoHotKey/setup/other/AutoHotkey-64.reg" || return
	$registry set "HKCU/SOFTWARE/Foo/File" REG_EXPAND_SZ "$(utw "$file")" || return

	service manual "Stereo Service"
	service manual "nvUpdatusService"

	$firewall rule add "SSH" dir=in action=allow protocol=TCP localport=22 profile=private program="$(utw "$P/OpenSSH/bin/sshd.exe")" || return

	makeDir "$_userDocuments/code/test"

	sublime profile restore default || return

	if askP 'Configure app'; then
		echot "\
	- configure"
		app start
	fi
}

usage()
{
	echot "\
usage: install cd|install APP*
	Install programs
	-h,  --hint DIR				first directory to search for installation files
	-nr, --no-run					do not find or run the installation program
	-np, --no-prompt	   	suppress prompts
	-p,	 --prompt 				force prompts
	-q,  --quiet					minimize informational messages
	-s,  --select					select the install location
	-v,  --verbose				verbose logging"
	exit $1
}

args()
{
	unset command apps forcePrompt host noPrompt noRun quiet select verbose verboseInstaller

	originalArgs=( "$@" ) 

	while (( $# != 0 )); do
		case "$1" in
			--help) IsFunction "${command}Usage" && ${command}Usage || usage 0;;
			--hint|-h) hint=( --hint "$2" ); export INSTALL_DIR="$2"; shift;;
			--no-prompt|-np) noPrompt="--no-prompt";;
			--no-run|-nr) noRun="--no-run";;
			--prompt|-p) forcePrompt="--prompt";;
			--quiet|-q) quiet="--quiet";;
			--select|-s) select="--select";;
			--verbose|-v) verbose="--verbose" verboseInstaller="-verbose";;
			"") : ;;
			*)
				[[ ! $command ]] && IsFunction "${1,,}Command" && { command="${1,,}"; shift; continue; } # command
				! IsOption "$1" && { apps+=( "$1" ); shift; continue; }
				UnknownOption "$1"
		esac
		shift
	done

	[[ ! $command ]] && command='install'
	[[ "$command" == "cd" && ${#apps[@]} != 0 ]] && UnknownOption "${apps[0]}"
	[[ "$command" == "apps" && ${#apps[@]} == 0 ]] && MissingOperand "APPS"
	args=("$@")
}

cdCommand()
{
	FindFile || return
	echo "$file"
}

installCommand()
{
	InstallInit || return
	InstallApps "${apps[@]}" || return
}

i() {	InstallApps "$@"; }
InstallApps()
{
	local prompt; 

	( [[ $forcePrompt ]] || (( $# > 1 )) ) && prompt="true"
	[[ $noPrompt ]] && prompt=

	while (($# != 0 )); do
		app="$1"; shift

		if ! IsInstallable "$app"; then
			[[ ! $quiet ]] && echo "$app is not installable on $PLATFORM $PLATFORM_LIKE $PLATFORM_ID"
			continue
		fi

		if [[ ! $prompt ]] || ask "\nInstall $app"; then
			installFunction="$(GetInstallFunction)" || { EchoErr "inst: $app installation does not exist"; return 1; }
			$installFunction || return 1
		fi
	done
	return 0
}

GetInstallFunction()
{
	declare -f | egrep -i "^${app} \(\) $|^${app}Install \(\) $" | sed "s/ () //" # Similar to GetFunction
	return ${PIPESTATUS[1]}
}

InstallInit() 
{
	ScriptEval HostFindInfo -d || return

	serverPrograms="$pp/Development"; [[ $server ]] && serverPrograms="$pp/Server";
	oo="$pp/Operating System/Other"

	askP() { [[ $noPrompt ]] && return 0; ask "$1"; }
	cp="FileCommand cp"
	cpDir="CopyDir --recursive"
	firewall="firewall --suppress"
	hide="FileHide"
	hideAndSystem="FileHideAndSystem"
	makeDir() { ${G}mkdir --parents "$@"; }
	makeDirSudo() { sudo ${G}mkdir --parents "$@"; }
	makeLink() { MakeLink --suppress $quiet $noPrompt "$@"; }
	makeShortcut="MakeShortcut"
	mergeDir() { MergeDir --parents --suppress "$@"; }
	mv="FileCommand mv"
	mvSudo() { [[ ! -e "$1" ]] && return; sudo mv "$1" "$2"; }
	registry="registry"
	ren="FileCommand ren"
	rm="${G}rm -f"
	rmSudo() { [[ ! -f "$1" ]] && return; sudo ${G}rm -f "$1"; }
	rmd="${G}rm -fr"
	sudo="sudo"
		
	netShareOptions=/grant:Everyone,full
	setupFiles="$_data/setup"
}

StoreInstall()
{
	local name id

	! IsPlatform mac,win && return

	(( $# == 2 )) && { name="$1" id="$2"; }
	(( $# == 1 )) && { id="$1"; }

	if [[ $name ]]; then
		printf "**************************************************\n* $name\n**************************************************\n"
		RunPrompt "$name" || return 0
	fi

	case "$PLATFORM" in 
		mac) mas open $id;;
		win) start RunProcess.exe ms-windows-store://pdp/?ProductId=$id;;
	esac
	
	RunPause
}

IsMacStoreId() { IsPlatform mac && IsInteger "$1"; }
MacAppConfigure() { askP "Do you want to configure $1" && { MacAppOpen "$1" || return; }; return 0; }
MacAppOpen() { open -a "$1" || return; pause; }

run() # run EXE [OPTIONS...]
{
	local p="$1"; shift; [[ ! $p ]] && return

	if [[ "$1" == @(-p|--platform) ]]; then
		local prefix="$p"

		shift

		case "$PLATFORM" in win) p="$1";; mac) p="$2";; linux) p="$3";; esac
		[[ ! $p ]] && return 0 # return if a program was not specified for the platform

		p="$prefix$p"
		shift; shift; shift;
	fi
	
	[[ $noRun ]] && return;

	IsMacStoreId "$p" && { StoreInstall "$p"; return; }
	FindFile "$p" || { ask "Continue the installation"; return; }
	RunProgram "$file" "$@" || return
}

RunPrompt()
{
	local desc="$1"
	[[ $noPrompt ]] && { echo "Runing $desc..."; return 0; }
	ask "Do you want to run $desc"
}

RunPause()
{
	[[ $pause ]] && pause "When the installation has finished press any key..."
	return 0
}

RunProgram()
{
	local p="$1" copyLocal elevate pause; shift

	[[ "$1" == @(--copy-local) ]] && { copyLocal="true"; shift; }
	[[ "$1" == @(--elevate) ]] && { elevate="elevate" pause="--pause"; shift; }
	[[ "$1" == @(--no-pause) ]] && { pause=""; shift; }
	[[ "$1" == @(--pause) ]] && { pause="--pause"; shift; }

	local pDesc pParts; StringToArray "$p" "/" pParts
	[[ ! $pDesc ]] && { pDesc="$(IFS=/; echo "${pParts[*]: -3}")"; }
	[[ ! $pDesc ]] && pDesc="$p"

	if [[ $copyLocal ]]; then
		local t="$(PlatformTmp)"
		cp "$p" "$t" > /dev/null
		p="$t/$(GetFileName "$p")"
	fi

	RunPrompt "$pDesc" || return 0

	local pExt; GetFileExtension "$p" pExt

 	[[ "$pExt" == @(air|iso|msu|vsix|xpi) ]] && pause="--pause"

 	[[ "$PLATFORM" == "win" ]] && export SEE_MASK_NOZONECHECKS=1 # disable Open File Secirity Warning

	case "$pExt" in
		AppImage) RunAppImage "$p" "$@" || return;;
		bat|cmd) cmd /c "$p" "$@" || return;;
		deb) ! InPath gdebi && { package gdebi || return; }; sudo gdebi "$p" "$@";;
		dmg) RunDmg "$p" "$@" || return;;
		inf) elevate --wait pnputil.exe -i -a "$p" "$@";;
		iso|img) iso mount "$p"; echo "If needed run the setup program manually..."; pause="--pause";;
		msi) msiexec.exe /quiet /qb /norestart /i "$(utw "$p")" "$@";;
		pkg) sudo installer $verboseInstaller -pkg "$p" -target /Applications;;
		7z|bz2|gz|tar|xpi|zip|ear|jar|war) 
			IsPlatform win && { elevate="--elevate" pause="--pause"; } || elevate=""
			InstallAppFromZip $elevate "$p" "$@" || return;;
		*) $elevate "$p" "$@" || return;;
	esac
	
	RunPause
	
	case "$pExt" in
		iso) iso dismount "$p" || return
	esac	
}

RunAppImage()
{
	local p="$1"; shift
	local appName="$(GetFileNameWithoutExtension "$p")"
	local app="$P/$(GetFileName "$p")"

	if [[ -f "$app" ]] && ask "Do you want to delete the existing installation in \"$appName\"" -dr n; then
		rmSudo "$app" || return
	fi

	if [[ ! -f "$app" ]]; then
		echo "Installing....$app"
		sudo gcp "$p" "$P" || { cat ~/.gcp/journal; return; }
	fi

	sudo chmod ugo+x "$app" || return

	echo "Configuring $appName..."
	start "$app" || return

	pause="--pause"
	return 0
}

RunDmg()
{
	local result

	DoRunDmg "$@"
	result=$?
	DmgCleanup

	return $result
}

DoRunDmg()
{
	local p="$1"; shift

	if ! hdiutil mount "$p" -mountpoint /Volumes/install -quiet; then
		EchoErr "inst: unable to mount \"$p\""
		hdiutil mount "$p" -mountpoint /Volumes/install
		return 1
	fi

	if [[ -f "/Volumes/install/Install.mpkg" ]]; then
		sudo installer $verboseInstaller -pkg "/Volumes/install/Install.mpkg" -target /Applications
	elif [[ -f "/Volumes/install/Install.app" ]]; then
		start "/Volumes/install/Install.app"
	elif ls /Volumes/install/*.pkg >& /dev/null; then
		sudo installer $verboseInstaller -pkg /Volumes/install/*.pkg -target /Applications
	else
		shopt -s nullglob; local app=(/Volumes/install/*.app);  

		[[ ! "$app" ]] && { EchoErr "inst: \"$p\" does not contain an application"; return 1; }
		local dir; GetFileName "$app" dir || return
		[[ -d "$P/$dir" ]] && { echo "$dir is already installed"; return 0; }
		sudo acp --recursive --progress-bar "$app" "$P"
	fi

	echo "Updating Spotlight..."
	mdimport "/Applications/$dir" || return
}

DmgCleanup() { hdiutil detach /Volumes/install -quiet || return; }

FindEditorProgram()
{
	args="" program=""
	sublime IsInstalled && { program="sublime" args="-w -n"; return; }
	program="$(GetTextEditor)"
}

FindCompareProgram()
{
	args="" name="" program=""	
	BeyondCompare IsInstalled && { name="bc" program="BeyondCompare"; return; }
	InPath kompare && { name="kompare" program="kompare"; return; }
	[[ -f "$P32/KDiff3/kdiff3.exe" ]] && { name="kdiff3" program="$P32/KDiff3/kdiff3.exe"; return; }
	return 1
}

FindFile()
{
	local pattern; file="$1"

	(IsMacStoreId "$file" || IsUrl "$file" ) && return 0

	if IsWild "$file"; then
		GetFileName "$file" pattern || return
		GetFilePath "$file" file || return
	fi

	if ! ScriptEval FindInstallFile $select --suppress --eval "${hint[@]}" "$file"; then
		EchoErr "inst: could not locate ${1:-the installation directory}"
		return 1
	fi

	hint=( --hint "$InstallDir" ); export INSTALL_DIR="$InstallDir"
	[[ $pattern ]] && { SelectFile "$file" "$pattern" || return; }
	return 0
}

SelectFile() # DIR PATTERN
{
	local dir="$1" pattern="$2" result items

	pushd "$dir" > /dev/null || return
	
	for f in $pattern; do items+=( "$f" "" ); done

	result=$(dialog --stdout --backtitle "Select File" \
  	--menu "Choose file to install:" $(($LINES-5)) 50 $(($LINES)) "${items[@]}")
	clear

	[[ ! $result ]] && { EchoErr "inst: a file was not selected"; return 1; }

	file="$dir/$result"
	popd > /dev/null
}

#
# bootstrap - initial setup on a fresh operating system
#

bootstrap()
{
	printf "**************************************************\n* Bootstrap\n**************************************************\n"

	i bash || return
	RunPlatform bootstrap || return

	askP "Change $USER password" && { password change || return; }
	askP "Change hostname from $HOSTNAME" && { os SetHostName || return; }

	IsPlatform debian,mac,win && { AppCore || return; }
}

bootstrapCommonPackages() # debian and macOS
{
	if ! InPath lynx > /dev/null; then
		printf "\nInstalling core packages..."
		package glances htop || return									# monitoring
		package fping nmap  || return 									# network	
		package tmux tmuxinator || return								# terminal
		package cowsay figlet fortune lolcat || return	# text
		package lynx || return 													# web
	fi

	return 0
}

bootstrapDebian() 
{
	bootstrapCommonPackages || return

	if ! InPath uuencode > /dev/null; then
		echo "Installing other packages..."
		package unzip zip || return																							# compression
		package bonnie++ hdparm inotify-tools nautilus || return								# file
		package fonts-inconsolata || return																			# fonts
		package atop iotop iperf3 gnome-system-monitor nethogs || returns				# monitoring
		package curl dnsutils etherwake smbclient || return											# network	
		package screen squidclient terminator tmux tmuxinator || return					# terminal
		package apcalc libdbus-glib-1-dev virt-what || return										# utility
		package lynx || return 																									# web
		package x11-apps xterm || return 																				# window
		package pv sharutils || return																					# other, sharutils (uuencode uudecode)
	fi

	# text editors
	if ! IsPlatform ubuntu,mac,win && ! InPath geany; then
		package geany gedit || return
	fi

	# policies
	if InPath systemctl && systemctl >& /dev/null; then
		echo "[Shutdown or suspend without a password]
Identity=unix-user:$USER
Action=org.freedesktop.login1.reboot-multiple-sessions;org.freedesktop.login1.set-wall-message;org.freedesktop.login1.halt;org.freedesktop.login1.power-off;org.freedesktop.login1.reboot;org.freedesktop.login1.suspend
ResultAny=yes" | sudo tee "/etc/polkit-1/localauthority/50-local.d/allow_shutdown_suspend.pkla"
	fi

	# file sharing
	if ! IsPlatform win && ! egrep -i "$USER" "/etc/samba/smb.conf" >& /dev/null; then
		package samba || return
		sudo smbpasswd -a $USER || return
		
		echo "[root]
path = /
valid users = $USER
read only = no" | sudo tee -a /etc/samba/smb.conf || return

		sudo service smbd restart || return
	fi

	echo "Configuring..."
	DbusSetup || return

	echo "Creating directories..."
	MakeDirOwner "$PUB" || return
	
	if ! IsPlatform win; then
		IsHypervVm && { i HypervLinuxTools || return; }
		IsVmwareVm && { i OpenVmTools || return; }
	fi

	return 0
}

bootstrapDsm()
{
	package adduser coreutils cowsay file gawk lynx man-pages nano nmap openssh tmux xterm xft || return
 	sudo chmod u+s /bin/ping || return # allow ping without sudo
 	sudo chmod u+s /bin/mount.cifs || return
	sudo chmod +s /sbin/shutdown || return
}

bootstrapMac()
{
	bootstrapCommonPackages || return

	if ! InPath mas > /dev/null; then
		printf "\nInstalling core programs..."
		package findutils wget wakeonlan || return	# network
		package cask mas || return 									# package
	fi

	if [[ ! -f "/etc/paths.d/wiggin" ]]; then
		sudo bash -c 'echo "/usr/local/data/bin
/usr/local/data/platform/mac
/usr/local/sbin" > /etc/paths.d/wiggin' || return;
	fi

	echo "Disabling dashboard..."
	defaults write com.apple.dashboard mcx-disabled -boolean true || return
	killall Dock || return
}

bootstrapQnap() 
{
	if ! InPath lynx > /dev/null; then
		printf "\nInstalling core packages..."
		package coreutils-expand coreutils-head coreutils-sort || return		# core utilities
		package dialog tmux || return																				# other
		package atop htop iotop iperf3 nethogs || return										# monitoring
		package etherwake nmap openssh-client-utils || return 							# network, fping is not functional
		package hdparm || return																						# disk
		package lynx || return																							# web
	fi

	# autorun
	clipw "mkdir /usr/etc/sudoers.d
echo \"$USER ALL=(ALL) ALL\" > /usr/etc/sudoers.d/$USER

sudo ln -s /share/Public/documents/data /usr/local/data"
	echo "- paste at the end of the file"
	qnap autorun || return

	return 0
}

bootstrapRaspbian()
{
	local locale="en_US.UTF-8" timezone="America/Denver"

	sudo raspi-config nonint do_net_names 0 || return # enable predictable network names
	sudo raspi-config nonint do_wifi_country US || return

	! cat /etc/timezone | grep "$timezone" >& /dev/null && { sudo raspi-config nonint do_change_timezone "$timezone" || return; }
	! cat /etc/default/locale | grep "$locale" >& /dev/null && { sudo raspi-config nonint do_change_locale en_US.UTF-8 || return; }
	[[ -f /run/sshwarn ]] && { echo "Changing password for pi."; sudo passwd pi || return; }
}

bootstrapUbuntu()
{
	IsPlatform win && return # Ubuntu setup is not applicable for Windows

	[[ -f gsettings ]] && { gsettings set org.gnome.desktop.session idle-delay 0 || return; } # do not blank screen

	echo "Updating file permissions..."
	chmod ugo+x "$BIN/"* || return

	if [[ ! -L /etc/localtime ]]; then
		echo "Updating timezone..."
		sudo mv /etc/localtime /etc/localtime.old || return
		sudo ln -s /usr/share/zoneinfo/America/Denver /etc/localtime || return
	fi

	return 0
}

bootstrapWsl()
{
	$makeShortcut "wsl.exe" "$pp/Operating System/bash" "" "$(utw "$DATA/icons/Command Prompt.ico")" || return
	$registry set "run/startup" REG_SZ 'c:\\Windows\\System32\\wsl.exe /usr/local/data/bin/RunScript startup' || return
	return 0
}

bootstrapWin()
{	
	echo "Core Windows setup..." # run first to minimize prompts
	i HiddenStartFinal || return
	$registry import "$setupFiles/SysInternalsEula.reg"

	echo "Update environment variables..."
	SetVar --system --path PATH "$DATA/platform/$PLATFORM" || return

	echo "Home directory..."
	makeLink --symbolic "$WIN_HOME/Desktop" "$HOME/Desktop" || return
	makeLink --symbolic "$WIN_HOME/Downloads" "$HOME/Downloads" || return

	echo "Other Windows programs..."
	i WindowsSetup || return

	return 0
}

#
# core programs
#

AppCore()
{
	printf "**************************************************\n* Core Applications\n**************************************************\n"
	AppInitial || return
	RunPlatform App || return
	AppHostHardwareCore || return
	AppHostCore || return
	AppUserCore || return
}

AppInitial()
{
	i firefox sublime AutoHotKey BeyondCompare ssh xServer || return # browser first for passwords
	! IsVm && { i JumpCloud zoom || return; }
	return 0
}

AppMac() { i iTerm KarabinerElements || return; }
AppWin() { i AquaSnap ninite || return; }

AppRaspbian() 
{ 
	! InPath gpio && { package wiringpi || return; }
	! groups $USER | grep gpio >& /dev/null && { sudo adduser $USER gpio || return; }
}

AppHostHardwareCore()
{
	local pc="IntelDriverUpdate nVidiaGeForceExperience LogitechOptions" mac="LogitechOptions"

	case "$HOSTNAME" in
		jane|pants) i $mac || return;;
		oversoul) i $pc || return;;
		rosie) i MsiMotherboard $pc || return;;
		ultron) i $pc || return;;
	esac
}

AppHostCore()
{
	local common="CleanMyPc Dropbox GreenShot notion office thunderbird"

	case "$HOSTNAME" in
		jane|micro|pants|rosie|ultron) i $common || return;; 
		oversoul) i $common dymo Quicken UltraMon || return;;
		pi5) i nodejs homebridge || return;;
	esac

	return 0
}

AppUserCore()
{
	local mac="apptivate bartender CarrotWeather magnet pcalc spark speedtest WallpaperWizard yoink"
	local win="AltTabTerminator TidyTabs Wallpaper4k"

	case "$USER" in
		jjbutare) i $mac $win || return;;
	esac
}

DevCore()
{
	printf "**************************************************\n* Development Core\n**************************************************\n"
	
	makeDir "$CODE/test" || return

	if IsPlatform win; then
		makeLink --merge "$WIN_HOME/source" "$CODE" || return
		$makeShortcut "$CODE" "$pp/Development/Code" || return
	fi

	i GitCore JetBrains DevDotNetCore DevJavaCore DevSqlCore DevWebCore || return
}

DevSqlCore()
{
	i iis SqlServerManagementStudio SqlPrompt SqlServer || return
}

DevDotNetCore() 
{
	printf "**************************************************\n* .NET Development Core\n**************************************************\n"

	if IsPlatform win; then
		makeDir "$pp/Development/DotNet/Other"
	fi

	i LinqPad NUnitConsole VisualStudioCode VisualStudio || return
}

DevJavaCore()
{
	printf "**************************************************\n* JAVA Development Core\n**************************************************\n"
	local java="$pp/Development/Java/Other"
	makeDir "$java" || return
}

DevWebCore()
{
	printf "**************************************************\n* Web Development Core\n**************************************************\n"
	i nodejs || return
	gem install compass || return	
	npm install -g yo bower grunt grunt-cli || return
}

GameCore()
{
	printf "**************************************************\n* Game Core\n**************************************************\n"
	i BlueStacks CorsairUtilityEngine oculus || return
	i EpicGames origin steam uplay || return
	i GameIcons || return
}

MediaCore()
{
	printf "**************************************************\n* Media Core\n**************************************************\n"
	i MediaBookCore MediaCameraCore MediaImageCore MediaMusicCore MediaVideoCore || return
}

MediaBookCore() { i calibre calibre2opds kindle; }
MediaCameraCore() { i CanonCamera; }
MediaImageCore() { i picasa FastStoneImageViewer IrfanView; }
MediaMusicCore() { i deezer iTunes MusicBee plex tidal sonos; }
MediaVideoCore() { i vlc; }

PiCore()
{
	printf "**************************************************\n* Raspberry Pi Core\n**************************************************\n"
 	i BalenaEtcher firefox || return;
}

SurveillanceCore()
{
	printf "**************************************************\n* Surveillance Core\n**************************************************\n"
	i AmcrestCamera qvr SurveillanceStation || return	
}

TravelCore()
{
	printf "**************************************************\n* Travel Core\n**************************************************\n"
	i garmin sena GoPro dji
}

UtilityCore()
{
	printf "**************************************************\n* Utility Core\n**************************************************\n"
 	Utility${PLATFORM^} || return
 	i UtilityDiskCore UtilityEncryptionCore UtilityHardwareCore UtilityNetworkCore || return
}

UtilityWin() { i RightClickEnhancer || return; }
UtilityMac() { :; }
UtilityLinux() { :; }

UtilityDiskCore() { i CleanMyPc DiskImager diskInventortyX LinkShellExtension ParagonExtFs PartitionAssistant TeraCopy ToDoBackup TrueImage; }
UtilityEncryptionCore() { i AxCrypt; }
UtilityHardwareCore() { i BrotherPrinter DasKeyboard DoxieGo dymo EpsonScan LabelMaker LgMonitor LogitechOptions EpsonScan PowerPanel; }
UtilityNetworkCore() { i GlassWire NordVpn TigerVnc tribler; }

VmCore() { Vm${PLATFORM^} || return; }
VmWin() { i VmwareWorkstation || return; }
VmMac() { i ParallelsDesktop || return; }
VmLinux() { :; }

#
# SSH Programs
# 

SshPermission()
{
	[[ ! -d ~/.ssh ]] && return

	sudo chown $USER ~/.ssh/* || return
	IsPlatform wsl && { chgrp $USER ~/.ssh/* || return; }

	chmod 700 ~/.ssh || return
	$hide ~/.ssh || return

	[[ -f ~/.ssh/config ]] && { sudo chmod 700 ~/.ssh/config || return; }
	[[ -f ~/.ssh//authorized_keys ]] && { chmod 700 ~/.ssh/authorized_keys || return; }
	[[ -f ~/.ssh/id_rsa ]] && { chmod 700 ~/.ssh/id_rsa || return; }
	[[ -f ~/.ssh/id_ed25519 ]] && { chmod 700 ~/.ssh/id_ed25519 || return; }

	return 0
}

ssh()
{
	printf "**************************************************\n* SSH\n**************************************************\n"
	makeDir ~/.ssh && $hide +h ~/.ssh || return
	SshPermission || return
	RunPlatform Ssh || return
}

SshWsl()
{
	if ! sudo grep $USER /etc/sudoers >& /dev/null; then
		echo "- paste at the end of the file"
		pause
		clipw "$USER ALL = (root) NOPASSWD: /usr/sbin/sshd -D"
		sudo visudo || return
	fi

	/usr/sbin/service ssh status | grep "not running" >& /dev/null && { sudo service ssh start || return; }

	return 0
}

SshMac()
{
	if ! grep "XAuthLocation /opt/X11/bin/xauth" /etc/ssh/ssh_config  >& /dev/null; then
		echo "Configuring SSH authentication..."
		echo "XAuthLocation /opt/X11/bin/xauth" | sudo tee -a /etc/ssh/ssh_config
	fi

	return 0
}

WinScp()
{
	printf "**************************************************\n* WiNSCP \n**************************************************\n"

	# https://winscp.net/eng/index.php
	run "Shareware/WinSCP/WinSCP-5.15.4-Setup.exe" || return

	$mv "$pp/WinSCP.lnk" "$pp/Operating System" || return
	$rm "$pd/WinSCP.lnk" || return

	clipw "$(utw "$udata/replicate/WinSCP.ini")"
	echot "\
- Tools, Preferences, Storage=Custom INI file=<paste>"
	"$P32/WinSCP/WinSCP.exe"
	pause
}

#
# Other Programs
#

Bash()
{
	printf "**************************************************\n* Bash - Bourne Again Shell\n**************************************************\n"
	printf "Configuring bash..."

	printf "links..."

	local files=(.bashrc .bash_logout .bash_profile .dialogrc .gitconfig .gitignore .kdiff3rc .lessfilter .magic .inputrc .minttyrc .Xresources)
	for file in "${files[@]}"; do
		printf "."
		makeLink --symbolic --hide "$UBIN/$file" "$HOME/$file" || return
	done

	if [[ ! -f /etc/ethers ]]; then
		sudo ${G}ln --symbolic "$BIN/ethers" "/etc/ethers" || return
	fi

	printf "config..."
	makeDir ~/.config || return
	for dir in $(ls $UBIN/.config); do
		if [[ -d "$UBIN/.config/$dir" ]]; then
			printf "."
			makeLink --symbolic "$UBIN/.config/$dir" "$HOME/.config/$dir" || return
		fi
	done

	printf "create..."
	files=( .bash_history .hushlogin .lesshst )
	for file in "${files[@]}"; do
		printf "."
		touch "$HOME/$file" || return
	done

	printf "ssh..."
	SshPermission || return

	echo "done"

	local file="/etc/bash.bashrc"
	local line='[[ -f /usr/local/data/bin/bash.bashrc ]] && . "/usr/local/data/bin/bash.bashrc"'
	local before='# If not running interactively, don'\''t do anything' 

	IsPlatform mac && { file="/etc/bashrc"; before="if [ -z \"$PS1\" ]; then"; }
	IsPlatform qnap && { file="/opt/etc/profile"; before="# Please note"; }
	IsPlatform dsm && { file="/etc.defaults/.bashrc_profile"; before="if [ -f ~/.bashrc ]; then"; }

	[[ ! -f "$file" ]] && { EchoErr "$file does not exist"; return 1; }

	if ! grep "$line" "$file" >& /dev/null; then
		IsPlatform debian && echo "- uncomment bash completion"
		echo "$line"; clipw "$line"
		echo "- paste before \"$before\""
		pause
		sudo nano "$file" || return
	fi

	return 0
}

nodeInstalled() { InPath node; }

NodeJsInstall()
{	
	local v="12"

	printf "**************************************************\n* Node.js v$v\n**************************************************\n"

	# https://nodejs.org/en/download/
	if [[ "$PLATFORM" == "linux" ]] && ( ! InPath node || ! node --version | grep v12 >& /dev/null); then
		echo "Installing node v$v..."
		curl -sL https://deb.nodesource.com/setup_$v.x | sudo -E bash || return # get node version 10.x
		package nodejs || return
	fi

	[[ ! -f ~/.npmrc ]] && { touch ~/.npmrc || return; }

	echo "Installing core node packages..."
	InPath nodemon || { $sudo npm install -g nodemon || return; }

	echo "Updating npm..."
	$sudo npm install -g npm@latest || return
	$sudo npm update -g || return

	echo "Rebuilding packages..."
	cd "$(sudo npm -g prefix)/lib/node_modules" || return
	sudo npm rebuild --unsafe-perm || return

	return 0
}

WinampInstall()
{
	printf "**************************************************\n* Winamp\n**************************************************\n"
	
	run "Nullsoft/WinAmp/setup/winamp565_pro_all.exe" || return

	echo "Updating icons..."
	mergeDir "$pp/Winamp" "$ao" || return
	mergeDir --rename "$up/Winamp Detector Plug-in" "$ao/Winamp" || return
	$rm "$pd/Winamp.lnk" || return

	echot "Note
- WiFi Sync - disable addition network interfaces (i.e. VMware networks), run WinAmp as Administrator"
}

wmp() { WindowsMediaPlayerInstall; }
WindowsMediaPlayerInstall()
{
	printf "**************************************************\n* Windows Media Player\n**************************************************\n"
	
 	start "$P32\Windows Media Player\wmplayer.exe" || return

	echot "\
- Recommended settings
- Organize, Manage Libraries, Music, Add..., This PC, portable4"
}

ahk() { AutoHotKeyInstall; }; AutoHotKeyInstall()
{
	printf "**************************************************\n* AutoHotKey\n**************************************************\n"

	AutoHotKey close || return

	# https://www.autohotkey.com/ https://autohotkey.com/download/2.0/
	run "Shareware/AutoHotKey/image/AutoHotkey_2.0-a108-a2fa0498.zip" "$P/AutoHotKey" || return 

	AutoHotKey startup || return
}

WinSplitInstall()
{
	printf "**************************************************\n* WinSplit\n**************************************************\n"
	run "Shareware/WinSplit Revolution/image.zip" "$P32/WinSplit Revolution" || return
	WinSplit startup
}

SublimeInstall()
{
	printf "**************************************************\n* Sublime Text Editor\n**************************************************\n"

	# http://www.sublimetext.com/3 
	local v=3211
	run "Sublime/setup/" -p "Sublime Text Build $v x64 Setup.exe" "Sublime Text Build $v.dmg" "sublime_text_3_build_${v}_x64.tar.bz2" || return 

	case "$PLATFORM" in

		debian) # https://www.sublimetext.com/docs/3/linux_repositories.html
			mvSudo "$P/sublime_text_3" "$P/sublime_text" || return

			echo "Installing sublime package repository for updates..."
			wget -qO - https://download.sublimetext.com/sublimehq-pub.gpg | sudo apt-key add - || return
			sudo apt-get install apt-transport-https || return
			echo "deb https://download.sublimetext.com/ apt/stable/" | sudo tee /etc/apt/sources.list.d/sublime-text.list || return
			sudo apt-get update || return
			sudo apt-get install sublime-text || return
			;;

		win)
			makeLink --merge --hide "$udata/app/Dash" "$udoc/Dash" || return
			registry delete "HKEY_CLASSES_ROOT/Applications/sublime_text.exe/" # Fix Windows Open With
			$ren "$pp/Sublime Text 3.lnk" "$pp/Applications/Sublime Text.lnk" || return
			makeDir "$adata/Sublime Text 3" || return; # for profile
			;;
			
	esac


	sublime profile restore default || return

	if askP 'Configure Sublime Text'; then
		echo '- Help, Enter license'
		sublime start || return
	fi
}

SublimeMergeInstall()
{
	printf "**************************************************\n* Sublime Merge\n**************************************************\n"

	# https://www.sublimemerge.com/download
	local v="1119"
	run "Sublime/merge/" -p "sublime_merge_build_${v}_x64_setup.exe" "sublime_merge_build_${v}_mac.zip" "sublime-merge_build_${v}_amd64.deb" || return;

	IsPlatform win && { $mv "$pp/Sublime Merge.lnk" "$pp/Applications" || return; }

	return 0
}

WindowsDownload()
{
	# https://www.microsoft.com/en-us/software-download/windows10/
	local v=1909
	run "Microsoft/Windows/setup/$v/MediaCreationTool$v.exe" --elevate || return

	[[ ! -f ~/Downloads/Windows.iso ]] && { EchoErr "Windpows was not downloaded"; return 1; }

	gcp ~/Downloads/Windows.iso "$(GetFilePath "$file")/Windows_$v.iso" || return
}

WindowsSetup()
{
	printf "**************************************************\n* Windows Setup\n**************************************************\n"
	! IsElevated && { elevate RunScript --pause-error inst WindowsSetup; pause; return; }

	WindowsPermissions || return
	WindowsDirs || return
	WindowsIcons || return
	WindowsConfiguration || return
	OneDrive || return
}

WindowsPermissions()
{
	! IsElevated && { elevate RunScript --pause-error inst WindowsPermissions; pause; return; }
	GrantFullPermission "$psm" || return
	GrantFullPermission "$pd" || return
}

WindowsDirs()
{
	makeDir "$WIN_ROOT/temp" || return
	
	makeDir "$pp/Applications/Other" || return
	makeDir "$pp/Development/Other" || return
	makeDir "$pp/Game/Other" || return
	makeDir "$pp/Media/Other" || return
	makeDir "$pp/Operating System/Other" || return
	makeDir "$pp/Surveillance/Other" || return

	makeDir "$up/Applications/Other" || return
	makeDir "$up/Development/Other" || return

	makeDir "$udata/app" || return

}

WindowsIcons()
{
	echo "Updating icons..."

	mergeDir "$up/Accessibility" "$pp/Applications/Accessories" || return
	mergeDir "$pp/Accessibility" "$pp/Applications/Accessories" || return
	mergeDir "$up/Accessories" "$pp/Applications" || return
	mergeDir "$pp/Accessories" "$pp/Applications" || return
	mergeDir "$pp/Administrative Tools" "$pp/Operating System" || return
	mergeDir "$up/Administrative Tools" "$pp/Operating System" || return
	mergeDir "$pp/IIS" "$pp/Development/Other/IIS" || return
	mergeDir "$up/System Tools" "$pp/Operating System" || return
	mergeDir "$pp/System Tools" "$pp/Operating System" || return
	mergeDir "$pp/Applications/Accessories/System Tools" "$pp/Operating System" || return
	mergeDir --rename "$pp/Microsoft Silverlight" "$oo/Silverlight" || return

	mvSudo "$pd/Mac Files.lnk" "$pp/Operating System" >& /dev/null
	$mv "$pp/Immersive Control Panel.lnk" "$pp/Applications/Accessories" || return
	$mv "$ud/Microsoft Edge.lnk" "$pp/Applications" || return
	$mv "$pp/OneDrive.lnk" "$up/Applications" || return
	$mv "$up/OneDrive.lnk" "$up/Applications" || return
	$mv "$pp/Windows Media Player.lnk" "$pp/Applications/Accessories" || return

	$rmd "$udoc/Fax"
	$rmd "$pp/Bluetooth Devices" || return
	$rmd "$up/Maintenance" || return
	$rmd "$WIN_HOME/3D Objects" || return

	$hideAndSystem "$pp/Applications/Accessories/Desktop.ini" || return
	$hideAndSystem "$pp/Applications/Accessories/Accessibility/Desktop.ini" || return

	# PowerShell
	mergeDir --rename "$up/Windows PowerShell" "$oo/PowerShell" || return
	mergeDir --rename "$pp/Windows PowerShell" "$oo/PowerShell" || return
	$hideAndSystem "$oo/PowerShell/desktop.ini" || return

	# 3rd party
	mergeDir "$pp/ICEpower" "$oo" || return	# Asus ZenBook laptop
}

WindowsConfiguration()
{
		echo "Windows console..."
	local key="HKCU/Console"
	$registry set "$key/ColorTable01" REG_DWORD 0 || return
	$registry set "$key/ColorTable11" REG_DWORD 16776960 || return
	$registry set "$key/ColorTable15" REG_DWORD 16777215 || return
	$registry set "$key/FaceName" REG_SZ "Lucida Console" || return
	$registry set "$key/FontFamily" REG_DWORD 54 || return
	$registry set "$key/FontSize" REG_DWORD 1048586 || return
	$registry set "$key/FontWeight" REG_DWORD 400 || return
	$registry set "$key/QuickEdit" REG_DWORD 1 || return
	$registry set "$key/QuickEditMode" REG_DWORD 1 || return
	$registry set "$key/ScreenBufferSize" REG_DWORD 19660964 || return
	$registry set "$key/ScreenColors" REG_DWORD 7 || return
	$registry set "$key/WindowSize" REG_DWORD 3276964 || return # 3276964=164x50

	echo "Cleaning file system..."
	$hide "$WIN_ROOT/PerfLogs" || return
	$hide "$WIN_ROOT/Windows.old" || return
	$rm "$WIN_HOME\Documents\My Music" || return
	$rm "$WIN_HOME\Documents\My Pictures" || return
	$rm "$WIN_HOME\Documents\My Videos" || return
	$rm "$WIN_HOME\My Music" || return
	$rm "$WIN_HOME\My Pictures" || return
	$rm "$WIN_HOME\My Videos" || return

	echo "Cleaning startup programs..."
	$registry 32 delete "run/NetFxUpdate_v1.1.4322" # "C:\Windows\Microsoft.NET\Framework\v1.1.4322\netfxupdate.exe" 1 v1.1.4322 GAC + NI NID, https://superuser.com/questions/137508/ngen-exe-is-constantly-using-cpu
	$registry delete "run/SecurityHealth" # %windir%\system32\SecurityHealthSystray.exe

	echo "Configuring..."
	powershell.exe Set-ExecutionPolicy RemoteSigned || return
	registry import "$setupFiles/Windows Setup.reg" || return
	numlock boot off || return
	netsh.exe advfirewall firewall set rule group="Network Discovery" new enable=Yes || return

	echo "Moving taskbar to the left side of the screen..."
	registry set 'HKCU/Software/Microsoft/Windows/CurrentVersion/Explorer/StuckRects3/Settings' REG_BINARY 30000000FEFFFFFF02000000000000004E0000003200000000000000000000004E000000380400007800000001000000
	
	echo "Enabling VPN to server behind NAT..." 
 	registry set "HKLM/SYSTEM/CurrentControlSet/Services/PolicyAgent/AssumeUDPEncapsulationContextOnSendRule" REG_DWORD 2 || return

	echo "Enabling remote desktop connections..." 
 	registry set "HKLM/SYSTEM/CurrentControlSet/Control/Terminal Server/fDenyTSConnections" REG_DWORD 0 || return

	echo "Configure file sharing..."
	$firewall group enable "File and Printer Sharing" || return
 	registry set "HKLM/SOFTWARE/Microsoft/Windows/CurrentVersion/Policies/system/LocalAccountTokenFilterPolicy" REG_DWORD 1 || return # Enable remote administrator access to protected file shares (admin$, c$...)

	echo "Hiding the recycle bin from the desktop..." 
 	registry set "HKCU/Software/Microsoft/Windows/CurrentVersion/Explorer/HideDesktopIcons/NewStartPanel/{645FF040-5081-101B-9F08-00AA002F954E}" REG_DWORD 1 || return

	echo "Showing taskbar on main display only..."
 	registry set "HKCU/Software/Microsoft/Windows/CurrentVersion/Explorer/Advanced/MMTaskbarEnabled" REG_DWORD 0 || return

	echo "Disable snap assist..."
 	registry set "HKCU/SOFTWARE/Microsoft/Windows/CurrentVersion/Explorer/Advanced/SnapAssist" REG_DWORD 0 || return

	echo "Disabling Explorer recent files and folders..."
 	registry set "HKCU/Software/Microsoft/Windows/CurrentVersion/Explorer/ShowFrequent" REG_DWORD 0 || return
 	registry set "HKCU/Software/Microsoft/Windows/CurrentVersion/Explorer/ShowRecent" REG_DWORD 0 || return

	# enable change - move taskbar to left side
	ProcessKill explorer && start explorer

	return 0
}

LxRunOfflineInstall()
{
	printf "**************************************************\n* LX Run Offline\n**************************************************\n"

	# https://github.com/DDoSolitary/LxRunOffline/releases
	run "LINUX/wsl/LxRunOffline/LxRunOffline-v3.4.0.zip" "$P/LxRunOffline" || return
}

pGina()
{
	printf "**************************************************\n* pGina\n**************************************************\n"
	
	IsInDomain && return 0
	
	# http://pgina.org/download.html
	run "Microsoft/Visual Studio/redistributable/vcredist_x86.exe" || return 
	run "Microsoft/Visual Studio/redistributable/vcredist_x64.exe" || return 
	run "Shareware/pGina/setup/pGinaSetup-3.1.8.0.exe" /silent || return # 

	echo "Updating icons..."
	mergeDir "$pp/pGina" "$oo" || return

	pGina profile restore default || return
}

DropboxInstall()
{
	printf "**************************************************\n* DropBox\n**************************************************\n"

	# https://www.dropbox.com/download?full=1&plat=win 
	# https://www.dropbox.com/download?full=1&plat=mac
	# https://www.dropbox.com/install-linux
	local v=97.4.467
	run "Dropbox/" -p "Dropbox $v Offline Installer.exe" "Dropbox $v.dmg" "dropbox_2019.02.14_amd64.deb" /S || return

	if askP 'Configure Dropbox'; then
		if IsPlatform win; then
			echot "\
		- Dropbox, Preferences...,
		  - General
		  	- uncheck Start Dropbox on system startup
				- Dropbox Badge, Show only if others present
			- Backups, Change AutoPlay Settings, Removable drive=Take no action
		  - Notifications, uncheck Edits to files
		  - Bandwidth, Upload rate, Don't Limit
		  - Sync, Selective Sync, uncheck large
		- Explorer
			- Dropbox, Include in Library, Documents
			-  Libraries, Documents, Library Tools, Manage, Manage library
		  	- Move Up (to top), Set as default save location
		  - View, List"
		else
			echot "\
		- Dropbox, Preferences...,
		  - Notifications, uncheck Edits to files
		  - Sync, Slective Sync, Choose folders, uncheck large"
		fi
		dropbox startup
		IsPlatform win && start explorer "$udoc"
	fi

	DropboxFinal || return
}

DropboxFinal()
{
	local company="Juntos Holdings" user="John Butare"

	if IsPlatform win; then

		mergeDir "$up/Dropbox" "$up/Applications/Other" || return
		mergeDir "$pp/Dropbox" "$pp/Applications/Other" || return
		$rm "$up/Startup/Dropbox.lnk" || return
		$rm "$ud/Dropbox.lnk" "$ud/$company Dropbox.lnk" || return

		#$registry 32 delete "run/Dropbox" # "C:\Program Files (x86)\Dropbox\Client\Dropbox.exe" /systemstartup
		$registry delete "HKCU/SOFTWARE/Microsoft/Windows/CurrentVersion/Explorer/Desktop/NameSpace/{E31EA727-12ED-4702-820C-4B6445F28E1B}/" # Desktop Dropbox icon
		$registry set "HKCU/SOFTWARE/Classes/CLSID/{E31EA727-12ED-4702-820C-4B6445F28E1A}/System.IsPinnedToNameSpaceTree" REG_DWORD 0 || return # Desktop Dropbox icon

		makeLink "$WIN_HOME/$company Dropbox/$user" "$HOME/Dropbox" || return
		$hide "$WIN_HOME/$company Dropbox/.dropbox" || return
	else
		makeLink "$HOME/$company Dropbox/$user" "$HOME/Dropbox" || return
	fi
}

vscode() { VisualStudioCode; }
VisualStudioCode()
{
	printf "**************************************************\n* Visual Studio Code\n**************************************************\n"
	echot "- check Add ... to Windows Explorer and Register Code"
	
	# https://code.visualstudio.com/
	run "Microsoft/Visual Studio/code/" -p "VSCodeUserSetup-x64-1.41.1.exe" "VSCode-darwin-stable.zip" "code_1.40.1-1573664190_amd64.deb" || return

	if IsPlatform win; then
		echo "Updating icons..."
		mergeDir "$up/Visual Studio Code" "$up/Development/other" || return
	fi

	return 0
}

vs() { VisualStudioInstall; }
VisualStudioInstall()
{
	vsInit || return
	printf "**************************************************\n* Visual Studio\n**************************************************\n"

	# https://www.visualstudio.com/downloads/
	run "$vs/setup/" -p "vs_Community.exe" "visualstudioformacinstaller.dmg" || return
	 
	ask 'Install VisualStudio extensions' && { VsExtensions || return; }
	VsFinal || return
}

VsExtensions()
{
	vsInit || return
	local vse="$vs/extension"

	run "$vse/VSColorOutput.vsix" || return # http://visualstudiogallery.msdn.microsoft.com/f4d9c2b5-d6d7-4543-a7a5-2d7ebabc2496
	run "$vse/SolutionLoadManager.vsix" # https://marketplace.visualstudio.com/items?itemName=kolomiets.SolutionLoadManager

	ask 'Install optional extensions' || return;
	run "$vse/Entrian-Attach-1.4.3-Setup.exe" || return # http://entrian.com/attach/download.html
	run "$vse/NuGetTools.vsix" # https://marketplace.visualstudio.com/items?itemName=Ahlman.Base16NuGetTools
	run "$vse/ProPowerTools.vsix" || return # https://marketplace.visualstudio.com/items?itemName=VisualStudioProductTeam.ProductivityPowerTools2015
}

vsInit()
{
	vs="Microsoft/Visual Studio"
}

VsFinal()
{
	ScriptEval VisualStudio init || return

	echo "Creating directories..."
	makeDir "$CODE/test/vs"

	ask "Install IIS Express Final" && { IisExpressFinal || return; }

	echo "Updating data folders..."
	makeLink --merge --hide "$vsData" "$udoc/Visual Studio $vsName" || return
	$hide ~/.dnx ~/.nuget || return

	ask "Update registry" && { VsRegistry || return; }

	ask "Update icons" && { VsIcons || return; }
	
	if ask "Restore profile"; then
		VisualStudio profile restore default || return
	else
		echot "\
Tools, Options...
- Environment
	- Documents, check Always reload modified files unless there are unsaved changes
	- Keyboard - see Visual Studio Shortcuts, search for custom
  - Tabs and Windows
  	- check Insert new tabs to the right of existing tabs
  	- check Show pinned tabs in a separate row
- Text Editor
	- C#
	  - General, check Line numbers
	  - Tabs, Tab size=3, Indent size=3, Keep tabs
	- XAML, General, check Word wrap, Line Numbers, and Navigation Bar
- Debugging, General
	- uncheck Break all processes when one process breaks
	- uncheck Require source files to exactly match the original version
- XAML Designer, Split Orientation=Vertical, 
View, Team Explorer...
- Home, Settings, Git Settings
  - Default Respository Location=$(utw "c:\Projects")
  - Check Enable download of author images from 3rd party source." 
		VisualStudio start
	fi
}

VsRegistry()
{
	echo "Updating Visual Studio registry..."
	ScriptEval VisualStudio init || return
	local r="$vsRegistryKey" c="$(utw "$CODE")"
	
	$registry 32 set "$r/DefaultFileOpenLocation" REG_EXPAND_SZ "$c" || return
	$registry 32 set "$r/DefaultNewProjectLocation" REG_EXPAND_SZ "$c" || return
	$registry 32 set "$r/DefaultNewProjItemLocation" REG_EXPAND_SZ "$c" || return
	$registry 32 set "$r/DefaultOpenProjectLocation" REG_EXPAND_SZ "$c" || return
	$registry 32 set "$r/DefaultOpenProjItemLocation" REG_EXPAND_SZ "$c" || return
	$registry 32 set "$r/DefaultOpenSolutionLocation" REG_EXPAND_SZ "$c" || return
	$registry 32 set "$r/VisualStudioProjectsLocation" REG_EXPAND_SZ "$c" || return
	$registry 32 set "$r/UserProjectTemplatesLocation" REG_EXPAND_SZ "$(utw "$vsData/Templates/ProjectTemplates")" || return
	$registry 32 set "$r/UserItemTemplatesLocation" REG_EXPAND_SZ "$(utw "$vsData/Templates/ItemTemplates")" || return
	$registry 32 set "$r/VisualStudioLocation" REG_EXPAND_SZ "$(utw "$vsData")" || return
}

VsIcons()
{
	echo "Updating Visual Studio icons..."
	ScriptEval VisualStudio init || return

	local base="$pp/Development/DotNet"
	local other="$base/Other"
	local vs="$other/Visual Studio $vsName"
	
	makeDir "$other" || return

	$makeShortcut "$WIN_ROOT/Windows/assembly" "$base/GAC.lnk" || return

	mergeDir --rename "$pp/Visual Studio $vsName" "$other/Visual Studio $vsName" || return
	mergeDir "$pp/Windows Kits" "$pp/Development/Other" || return
	$ren "$pp/Visual Studio $vsName.lnk" "$base/Visual Studio.lnk" || return
	$mv "$pp/Visual Studio Installer.lnk" "$vs" || return
	$ren "$pp/Microsoft Test Manager $vsVersion.lnk" "$vs/Test Manager.lnk" || return

	$ren "$pp/Blend for Visual Studio $vsName.lnk" "$vs/Blend.lnk" || return
	$ren "$pp/Microsoft Expression/Microsoft Expression Blend SDK/Expression Blend SDK Documentation.lnk" "$vs/Expression Blend SDK Documentation.lnk"  || return
	$rmd "$pp/Microsoft Expression" || return

	$mv "$up/Microsoft Corporation/Microsoft Teams.lnk" "$up/Development" || return
	[[ -d "$up/Microsoft Corporation" ]] && { rmdir "$up/Microsoft Corporation" || return; }

	SilverlightIcons || return	
}

IisExpressFinal()
{
	echo "Moving data folders..."
	makeLink --merge --hide "$udata/app/IISExpress" "$udoc/IISExpress"

	echo "Setting permissions..."
	icacls "$(utw "$P32/IIS Express")" /grant "$USER:(OI)(CI)F" /T
}

BcInstall() { BeyondCompareInstall; }
BeyondCompareInstall()
{	
	printf "**************************************************\n* BeyondCompare\n**************************************************\n"

	# http://www.scootersoftware.com/download.php
	local v=4.3.4.24657
	run "Scooter Software/Beyond Compare/setup/" -p "BCompare-${v}_x64.msi" "BCompareOSX-${v}.zip" "bcompare-${v}_amd64.deb" || return

	if IsPlatform win; then	
		mergeDir --rename "$pp/Beyond Compare 4" "$ao/Beyond Compare" || return
		$rm "$pd/Beyond Compare 4.lnk" || return
		$rm "$ud/Beyond Compare 4.lnk" || return
		$registry delete "urun/BCClipboard" # C:\Program Files\Beyond Compare 4\BCClipboard.exe
	fi

	if askP 'Configure BeyondCompare'; then
		echo "- Help|Preferences, Enter Key..."
		[[ "$PLATFORM" == "mac" ]] && echo "- Beyond Compare, Install Command Line Toolsâ€¦"
		BeyondCompare --wait start
	fi
	
	BeyondCompare profile restore default || return

	return 0
}

sonos()
{
	printf "**************************************************\n* Sonos Music System\n**************************************************\n"
	
	# http://sonos.com/support/
	run "Sonos/setup/SonosDesktopController110." -p "exe" "dmg" "linux" --elevate || return

	case "$PLATFORM" in
		win) $rm "$pd/Sonos.lnk" || return; mergeDir "$pp/Sonos" "$pp/Media/Other" || return;;
		mac) MacAppConfigure Sonos;;
	esac
}

nUnitConsoleInstall()
{
	printf "**************************************************\n* NUnit\n**************************************************\n"
	echo "Choose Setup Type=Complete"
	
	local version="3.9.0" # http://nunit.org/download/
	run "Shareware/DOT.NET/NUnit/setup/NUnit.Console-$version.msi" || return 

	echo "Updating icons..."
	#mergeDir "$up/NUnit $version" "$pp/Development/DotNet/Other"
}

SilverlightSdk()
{
	printf "**************************************************\n* Silverlight SDK\n**************************************************\n"

	# downloads  http://www.silverlight.net/downloads
	# - Developer Runtime (required, debugging): http://go.microsoft.com/fwlink/?linkid=229324
	# - toolkit (required, additonal controls): http://silverlight.codeplex.com/ http://silverlight.codeplex.com/releases/view/78435
	# - SDK (required if Visual Studio is not installed): http://www.microsoft.com/en-us/download/details.aspx?id=28359 
	# - tools (developer runtime, SDK, Visual Studio 2010 support): http://www.microsoft.com/en-us/download/details.aspx?id=28358
	# version: http://www.microsoft.com/getsilverlight/Get-Started/Install/Default.aspx
	run "Microsoft/DOT.NET/Silverlight/development/Silverlight_Developer_64.exe"

	run "Microsoft/DOT.NET/Silverlight/development/Silverlight_5_Toolkit_December_2011.msi"

	SilverlightIcons || return
}

SilverlightIcons()
{
	local base="$pp/Development/DotNet/Other/Silverlight"
	makeDir "$base" || return

	$ren "$pp/Microsoft Silverlight/Microsoft Silverlight.lnk" "$pp/Applications/Accessories/Silverlight.lnk"  || return
	$ren "$pp/Microsoft Silverlight 5 SDK/Welcome.lnk" "$base/Silverlight 5 SDK Welcome.lnk" || return

	mergeDir --rename "$pp/Microsoft Silverlight 5 Toolkit December 2011" "$base/Silverlight 5 Toolkit" || return

	$rmd "$pp/Microsoft Silverlight 5 SDK" || return
	$rmd "$pp/Microsoft Silverlight" || return
}

cctray() { CruiseControlTrayInstall; }
CruiseControlTrayInstall()
{
	local version="1.8.5.0"
	printf "**************************************************\n* CruiseControl Tray\n**************************************************\n"
	echo '- Uncheck Run CruiseControl.NET CCTray 1.8.5.0'	

	# download: http://vmspwbld001/ccnetpreprod/ViewFarmReport.aspx http://www.cruisecontrolnet.org/projects/cctray http://cruisecontrol.sourceforge.net http://ccnet.sourceforge.net/CCNET/CCTray.html https://github.com/ccnet/CruiseControl.NET
	run "Shareware/CruiseControl/tray/CruiseControl.NET-CCTray-$version-Setup.exe" || return

	echo "Installing plugins..."	
	FindFile "Shareware/CruiseControl/plugins/CCTray" || return
	$cp	"$file"/* "$P32/CCTray" || return

	echo "Updating icons..."
	mergeDir "$pp/CCTray" "$pp/Development/Other" || return
	mergeDir "$up/CCTray" "$pp/Development/Other" || return
	$rm "$ud/CCTray.lnk" || return
	$rm "$up/Startup/CCTray.lnk" || return

	CruiseControlTray profile restore default || return
	CruiseControlTray startup || return

 	wincred get CCTray:$USER >& /dev/null || echot "\
- File, Settings, Build Projects, Add..., select a secure Build Server,
  check Server is secure, Authorisation Mode=Secure user name/password authentication,
  Configure, Username=%USERNAME%"
}

firefoxInstall()
{
	printf "**************************************************\n* Firefox\n**************************************************\n"

	# https://www.mozilla.org/en-US/firefox/all/
	local v="76.0.1"
	if IsPlatform raspbian; then
		package firefox-esr || return
	else
		run "Mozilla/Firefox/" -p "Firefox Setup $v.msi" "Firefox $v.dmg" "firefox-$v.tar.bz2" || return
	fi

	echot "\
- Options, Sign in to Sync, Sign In...
- LastPass
	- LastPass, Accept, Login, check Remember Password
	- right click LastPass, Manage Extensions, ..., Options, Icons, select grey
- https://duckduckgo.com/, settings, Other Settings, Load Settings, DuckDuckButare"
	pause
	
	if [[ "$PLATFORM" == "win" ]]; then	
		$mv "$pp/Firefox.lnk" "$pp/Applications" || return
		$rm "$pd/Firefox.lnk" || return
	fi

	firefox profile restore default || return

	return 0
}

thunderbird()
{
	printf "**************************************************\n* Thunderbird\n**************************************************\n"

	# https://www.thunderbird.net/en-US/thunderbird/all/#E
	local v="68.8.0"
	run "Mozilla/Thunderbird/" -p "Thunderbird Setup $v.msi" "Thunderbird $v.dmg" "thunderbird-$v.tar.tar" || return

	if IsPlatform win; then
		$ren "$pp/Mozilla Thunderbird.lnk" "$pp/Applications/Thunderbird.lnk" || return
		$rm "$pd/Mozilla Thunderbird.lnk" || return
	fi

	makeDir "$APPDATA/Thunderbird" || return
	profile --app "Thunderbird" --method "$APPDATA/Thunderbird" restore default || return
}

chromeInstall()
{
	printf "**************************************************\n* Google Chrome Browser\n**************************************************\n"
	echo '- Sign in, Email=NNN, Password=NNN'
	
	# https://www.gtricks.com/chrome/how-to-download-chrome-offline-installer-for-windows-mac-and-linux/
	# https://www.google.com/chrome/?system=true&standalone=1&platform=win64
	# https://www.google.com/chrome/?platform=mac
	# https://www.google.com/chrome/?platform=linux
	run "Google/Chrome/setup/" -p "ChromeStandaloneSetup64.exe" "googlechrome.dmg" "google-chrome-stable_current_amd64.deb" --elevate || return

	if [[ "$PLATFORM" == "win" ]]; then
		ChromeIcons || return

	elif [[ "$PLATFORM" == "mac" ]]; then	
		$rm "$la\com.google.keystone.agent.plist" || return
	fi

	echot "- Settings, uncheck Continue running background apps when Google Chrome is closed"
}

ChromeIcons()
{
		$mv "$pp/Google Chrome.lnk" "$pp/Applications" || return
		$rm "$up/Google Chrome.lnk" || return
		$rm "$ud/Google Chrome.lnk" || return
		$rm "$pd/Google Chrome.lnk" || return
		$rm "$ud/Chrome App Launcher.lnk" || return
		$rm "$ud/Google Chrome Canary Build.lnk" || return
		mergeDir --rename "$pp/Google Chrome" "$ao/Chrome" || return
		mergeDir --rename "$up/Google Chrome" "$ao/Chrome" || return
		mergeDir "$up/Chrome Apps" "$up/Applications" || return
		mergeDir --rename "$up/Google Chrome Canary Build" "$ao/Chrome Beta" || return
		mergeDir "$up/Chrome Apps" "$up/Applications/Other" || return
}

iisInstall()
{
	# - Add/Remove Windows Components requires inf files
	# - Remote Desktop Web Connection reference http://www.microsoft.com/windowsxp/using/networking/expert/northrup_03may16.mspx
	printf "**************************************************\n* IIS\n**************************************************\n"
  echo "- Internet Information Services, check all"
  echo "- (optional) Internet Information Services Hostable Web Core"
	
	product optional --wait || return

	if [[ $client ]]; then
	  echo "Updating firewall..."
	  $firewall rule enable "World Wide Web Services HTTP Traffic In"
	fi

	echo "Updating services..."
	service exist FTPSVC && { service manual FTPSVC || return; }

	if [[ $client ]] && ask "Set IIS services to run manually"; then
	  service exist IISADMIN && { service manual IISADMIN || return; }
	  service exist w3svc && { service manual w3svc || return; }
	  service exist AppHostSvc && { service manual AppHostSvc || return; }
	fi

	echo "Updating icons..."
	makeDir "$pp/Development/Other/IIS" || return
	mergeDir "$pp/IIS" "$pp/Development/Other" || return
	$makeShortcut "$WINDIR/system32/inetsrv/iis.msc" "$pp/Development/Other/IIS/IIS Client Manager" || return

	# [[ $client ]] && ask "Install remote manager" && { IisRemoteManager || return; }
	# ask "Configure WebDAV" --default n && { IisWebDav || return; }
	# ask "Configure FTP" --default n && { IisFtp || return; }
	# ask "Configure debugging" --default n && { IisDebugging || return; }
	# ask "Configure compression" --default n && { IisCompression || return; }
	# ask "Configure SSL" --default n && { IisSsl || return; }

	echo "Restarting IIS..."
	iisreset
}

IisCheck()
{ 
	if ! IsInstalled iis && ask "Do you want to install IIS"; then
		iisInstall; return
	fi
	return 0
}

ssms() { SqlServerManagementStudioInstall; }
SqlServerManagementStudioInstall()
{
	local base="Microsoft/SQL Server"

	run "$base/studio/SSMS-Setup-ENU.exe" || return # https://docs.microsoft.com/en-us/sql/ssms/download-sql-server-management-studio-ssms
	run "$base/studio/plugins/SSMSBoostInstaller_3.4.6796.msi" || return # http://www.ssmsboost.com

	echo "Moving data folders..."
	local dir="$udata/app/SQL Server Management Studio"; makeDir "$dir" || return
	makeLink --merge --hide "$udata/app/SQL Server Management Studio" "$udoc/SQL Server Management Studio" || return

	echo "Linking script directory..."
	[[ -d "$CLOUD/data/sql" ]] && { $makeShortcut "$CLOUD/data/sql" "$dir/Personal.lnk" || return; }

	ask "Update registry" && { SsRegistry || return; }

	SsFinal || return

	SqlServerManagementStudio start || return

	if ask 'Restore profile'; then
		SqlServerManagementStudio profile restore default || return
	else
		echot "\
	- View, Registered Servers
	- Tools, Options
	  - Environment
	    - General, 20 items shown
	    - Startup, At startup Open empty environment
	  - Text Editor
	    - All Languages, check Line numbers
	    - Editor Tab and Status Bar, Tab Text, all but Include File Name to False
	   - Query Execution, SQL Server, ANSI, uncheck SET QUOTED IDENTIFIER
	- Tools, Customize, Keyboard...
		- View.ZoomIn=Ctrl+Num +
		- View.ZoomOut=Ctrl+Num -"
		pause
	fi
}

ss() { SqlServerInstall; }
SqlServerInstall()
{
	local base="Microsoft/SQL Server"
	local setup="en_sql_server_2017_enterprise_x64_dvd_11293666"; [[ $client ]] && setup="en_sql_server_2017_developer_x64_dvd_11296168"
	printf "**************************************************\n* SQL Server \n**************************************************\n"

	echot "\
Setup logs are in \"$P/Microsoft SQL Server/130/Setup Bootstrap/Log\"
- run <drive>\setup.exe
- Installation, New SQL installation
- Feature Selection, Select Database Engine Services, SQL Server Replication
- Server Configuration, check Grant Perform Volume Maintenance Task provilege
- Database Engine Configuration
  - Authentication Mode=Mixed Mode, Enter password=XXX, Confirm password=XXX
  - Add Current User"
 	run "$base/setup/$setup.iso" || return

	ask "Update server configuration" && { SsServerConfig || return; }
	ask "Cleanup log" && { SsLogCleanup || return; }
	ask "Update services" && { SsUpdateServices || return; }
		
	SsFinal || return
}

SsLogCleanup()
{
	ScriptEval SqlServer init || return

	echo "Removing log files..."
	$rmd "$P/Microsoft SQL Server/${versionNun}0/Setup Bootstrap/Log" || return
}

SsServerConfig()
{
	ScriptEval SqlServer init || return

	echot "\

- SQL Server Network Configuration, Protocols for MSSQLSERVER
- Named Pipes and TCP/IP=Enabled
- TCP/IP, IP Addresses
	- (IP for primary NIC) IPn, Enabled=Yes
	-IPAll, TCP Port=$port"
	SqlServer config
	pause
	SqlServer service restart

	echot "
- Object Explorer, Server, Properties, Memory, Maximum server memory=256"
	SqlServerManagementStudio || return
	pause

	echo "Updating firewall..."
	local port=1433
	$firewall rule add "SQL Server" dir=in action=allow protocol=TCP localport=$port profile=private \
		program="$(utw "$P/Microsoft SQL Server/MSSQL${versionNum}.MSSQLSERVER/MSSQL/Binn/sqlservr.exe")" || return
}

SsUpdateServices()
{
	[[ ! $client ]] && return 0

 	echo "Updating services..."
	SqlServer service demand --all || return
	SqlServer service stop --all || return

	if ask 'Automatically start SQL Server' -dr n; then
		SqlServer service auto || return
		SqlServer service start || return
	fi
}

SsFinal()
{
	SsIcons || return;

	os path editor || return
	echo "- Remove SQL entries from the system path"
	pause
}

SsRegistry()
{
	ScriptEval SqlServerManagementStudio init || return	

	local dir="$(utw "$udata/sql")" r="HKCU/Software/Microsoft/SQL Server Management Studio/${versionNum}.0"

	echo "Updating SQL Server registry..."
	$registry set "$r/DefaultBrowseComponentLocation" REG_EXPAND_SZ "$dir" || return
	$registry set "$r/DefaultFileOpenLocation" REG_EXPAND_SZ "$dir" || return
	$registry set "$r/DefaultNewProjectLocation" REG_EXPAND_SZ "$dir" || return
	$registry set "$r/DefaultNewProjItemLocation" REG_EXPAND_SZ "$dir" || return
	$registry set "$r/DefaultOpenProjectLocation" REG_EXPAND_SZ "$dir" || return
	$registry set "$r/DefaultOpenProjItemLocation" REG_EXPAND_SZ "$dir" || return
	$registry set "$r/DefaultOpenSolutionLocation" REG_EXPAND_SZ "$dir" || return
}

SsIcons()
{
	echo "Updating icons..."	
	mergeDir --rename "$pp/Microsoft SQL Server Tools 17" "$serverPrograms/Other/SQL Server Tools 2017"
	mergeDir --rename "$pp/Microsoft SQL Server vNext CTP2.0" "$serverPrograms/Other/SQL Server 2017"		
	mergeDir --rename "$pp/Microsoft SQL Server 2017" "$serverPrograms/Other/SQL Server 2017"
	mergeDir --rename "$pp/Microsoft SQL Server 2016" "$serverPrograms/Other/SQL Server 2016"
	mergeDir --rename "$pp/Microsoft SQL Server 2014" "$serverPrograms/Other/SQL Server 2014"
	mergeDir --rename "$pp/Microsoft SQL Server 2012" "$serverPrograms/Other/SQL Server 2012"
	mergeDir --rename "$pp/Microsoft SQL Server 2008" "$serverPrograms/Other/SQL Server 2008"
}

SqlPromptInstall()
{
	printf "**************************************************\n* SQL Prompt\n**************************************************\n"
	run "RedGate/SQLPromptDownload.exe" || return # downloads to $tmp/Red Gate http://www.red-gate.com/products/sql-development/sql-prompt

	echo "Updating icons..."
	mergeDir "$pp/Red Gate" "$pp/Development/Other"

	echot "\
- SQL Prompt
	- Help, Enter Serial Number...
	- Tabs, History, uncheck Restore open tabs"
	 SqlServerManagementStudio || return
	 pause
}

OfficeInstall()
{
	printf "**************************************************\n* Office 365\n**************************************************\n"

	# https://stores.office.com/myaccount/advancedinstalls.aspx 
	run "Microsoft/Office/" -p "Setup.X64.en-US_O365HomePremRetail_08b88893-8375-4065-aeb5-26309617dc27_TX_PR_.exe" "Microsoft_Office_16.37.20051002_Installer.pkg" || return
	OfficeFinal || return
}

OfficeFinal()
{
	if IsPlatform win; then
		. office.sh || { EchoErr "inst: Office is not installed"; return 1; }

		makeDir "$_data/templates" "$udata/app/office" "$udata/templates" || return
		MakeLink --merge --hide "$udata/app/office/template" "$udoc/Custom Office Templates" || return
	
		registry import "$setupFiles/ShellNew.reg" || return
	
		OfficeIcons || return
	fi

	ask "Restore normal templates" && { word RestoreNormal || return; }
	ask "Configure Word" && { word configure || return; }

	return 0
}

OfficeIcons()
{
	echo "Updating icons..."

	p="$ao/Office"
	makeDir "$p" || return

	mergeDir --rename "$pp/Microsoft Office Tools" "$p/tools" || return
	$mv "$pp/"Access.lnk "$p" || return
	$mv "$pp/"Excel.lnk "$p" || return
	$mv "$pp/"Outlook.lnk "$p" || return
	$mv "$pp/"PowerPoint.lnk "$p" || return
	$mv "$pp/"Publisher.lnk "$p" || return
	$mv "$pp/"Word.lnk "$p" || return
	$rm "$up/Startup/Send to OneNote.lnk" || return

	SkypeIcons || return

	# Office 2013 icons
	mergeDir --rename "$pp/Microsoft Office 2013" "$p" || return
	mergeDir --rename "$p/Office 2013 Tools" "$p/tools" || return
	for f in "$p/"*2013.lnk; do $ren "$f" "${f/ 2013/}" || return; done
	for f in "$p/tools/"*2013*.lnk; do $ren "$f" "${f/ 2013/}" || return; done
	
	# Office 2016 icons
	mergeDir --rename "$pp/Microsoft Office 2016 Tools" "$p/tools" || return
	$mv "$pp/"*2016.lnk "$p" || return
	for f in "$p/"*2016.lnk; do $ren "$f" "${f/ 2016/}" || return; done
	for f in "$p/tools/"*2016*.lnk; do $ren "$f" "${f/ 2016/}" || return; done

	echo "Updating registry..."	
	$registry delete "urun/Lync" # "c:\Program Files\Microsoft Office\root\office16\lync.exe" /fromrunkey
}

nVidiaGeForceExperienceInstall()
{
	printf "**************************************************\n* nVidia GeForce Experience\n**************************************************\n"

	# https://www.nvidia.com/en-us/geforce/geforce-experience/
	run "hardware/nVidia/experience/GeForce_Experience_v3.20.3.63.exe" --elevate || return

	nVidiaIcons || return
}

nVidiaDriverInstall()
{
	printf "**************************************************\n* nVidia Driver\n**************************************************\n"

	# https://www.nvidia.com/en-us/drivers/results/159423/
	run "hardware/nVidia/driver/445.87/setup.exe" --elevate

	nVidiaIcons || return
}

nVidiaIcons()
{
	mergeDir --rename "$pp/NVIDIA Corporation" "$oo/NVIDIA" || return
	$rm "$pd/GeForce Experience.lnk" || return
	return 0
}

GitCore()
{
	RunPlatform git
	IsPlatform win && { sudo git config --system core.filemode false || return; } # posix permissions do not work well on windows file systems
	i SublimeMerge || return
	ask 'Clone bin' && { GitHelper bin || return; }
	return 0
}

gitDebian()
{
	[[ $prompt ]] && ! ask "Install Debian git packages" && return 0
	package git git-extras gitg tig || return
	return 0
}

gitMac()
{
	i GitX || return
	ask 'Install git-extras and hub' && { package bash-completion git git-extras hub tig || return; }
}

gitRaspbian()
{
	ask "Install kompare" && { package kompare || return; }
	return 0
}

gitWin()
{
	# .gitconfig link - for Windows programs, make it a hard link (symbolic links require elevation)
	if [[ ! -f "$WIN_HOME/.gitconfig" ]]; then
		MakeLink --hide --hard $WIN_HOME/Documents/data/bin/.gitconfig $WIN_HOME/.gitconfig || return
	fi

	i gitForWindows gitExtensions || return

	return 0
}

gfwInstall() { gitForWindows; }
gitForWindows()
{
	printf "**************************************************\n* Git for Windows\n**************************************************\n"
	
	# https://git-scm.com/download/win
	# https://github.com/git-for-windows/git/releases/
	run "Shareware/Git for Windows/setup/Git-2.26.2-64-bit.exe" /silent || return 
	
	echo "Updating icons..."
	mergeDir "$pp/Git" "$pp/Development/Other" || return
	mergeDir "$up/Git" "$pp/Development/Other" || return
	$rm "$up/Git for Windows.lnk"	|| return

	askP 'Configure Git For Windows' && { ConfigureGitForWindows || return; }

	return 0
}

ConfigureGitForWindows()
{
	local gw="$P/Git/cmd/git.exe"

	! IsElevated && { elevate RunScript --pause-error inst ConfigureGitForWindows; pause; return; }

	if [[ -f "$P/Git/usr/bin/ssh.exe" ]]; then
		echo "Disable ssh..."
		mv "$P/Git/usr/bin/ssh.exe" "$P/Git/usr/bin/ssh_hold.exe" || return
	fi

	echo "Configuring git for windows..."
	"$gw" config --system http.sslcainfo "$(utw "$P/Git/usr/ssl/certs/ca-bundle.crt")" || return
	"$gw" config --system core.fscache true || return
	"$gw" config --system core.filemode false || return
	"$gw" config --system core.autocrlf false || return
	"$gw" config --system credential.helper wincred || return
}

ge() { gitExtensions; }
gitExtensions()
{
	printf "**************************************************\n* Git Extensions\n**************************************************\n"
	
	# https://github.com/gitextensions/gitextensions/releases/latest
	run "Shareware/GitExtensions/setup/GitExtensions-3.3.1.7897.msi" || return

	GitHelper gui || return
	echot "- English, Quit"
	pause

	echo "Creating files..."
	local f="$WIN_HOME/.gitconfig.backup"
	[[ -f "$f" ]] && { start attrib -h -s "$f" || return; }
	FileTouchAndHide "$WIN_HOME/.gitconfig.backup" || return

	echo "Updating icons..."
	makeDir "$pp/Development/Other/Git" || return
	mv "$pp/Git Extensions.lnk" "$pp/Development/Other/Git" || return
	rm -f "$pd/Git Extensions.lnk" || return

	GitHelper profile restore default || return
}

gitUp()
{
	pip3 install git-up || return;
	git config --global git-up.rebase.auto false || return
}

gitX()
{
	printf "**************************************************\n* GitX\n**************************************************\n"
	run "Shareware/GitX/GitX-dev.dmg" || return # http://rowanj.github.io/gitx/
}

gitKraken()
{
	printf "**************************************************\n* Git Kraken\n**************************************************\n"
	run "Shareware/Git Kraken/setup/" -p "GitKrakenSetup.exe" "installGitKraken.dmg" "" || return # https://www.gitkraken.com/download

	echo "Updating icons..."
	$mv "$pp/GitKraken.lnk" "$pp/Development/Other/Git" || return
}

gitHub()
{
	printf "**************************************************\n* GitHub\n**************************************************\n"
	run "GitHub/setup/GitHubSetup.exe" || return # https://github-windows.s3.amazonaws.com/GitHubSetup.exe
	pause
	
	echo "Updating icons..."
	mergeDir --rename "$up/GitHub, Inc" "$up/Development/Other/GitHub" || return
	$rm "$ud/GitHub.appref-ms" || return
	$rm "$ud/Git Shell.lnk" || return

	echot "\
- GITHUB ENTERPRISE, GitHub Username or Email=IDSID
- Password=NNN
- GitHub Enterprise URL=https://GitHub.intel.com/
- Full Name=NNNN
- tools, options...
	- default storage directory=c:\Projects
	- SCAN FOR REPOSITORIES
- note: 
	- GitHib is useful for quickly cloning a repository from GitHub
	- clone a repository - click an account on the left channel, right click on the repository, and select Clone To..."
}

tortoiseGit()
{
	printf "**************************************************\n* TortoiseGit\n**************************************************\n"
	
	echot "- (optional) Check Registrer link handlers"
	run "Shareware/TortoiseGit/setup/TortoiseGit-1.8.7.0-64bit.msi" || return # https://code.google.com/p/tortoisegit/wiki/Download?tm=2

	echo "Updating icons..."
	mergeDir "$pp/TortoiseGit" "$pp/Development/Other"

	FindCompareProgram || return; clipw "$(utw "$program")" || return
	echot "\
- General
	- Contect Menu, uncheck all but Clone and Show log
	-Dialogs 1, check Enable Gravatar
- (optional) Diff Viewer (1 place) and Merge Tool (1 place), External=<paste>
- Icon Overlays
	- check Unversioned files mark parent folder as modified
	- Icon Set, Icon Set=Straight"
	GitHelper tgui /command:settings || return
}

appleCore()
{
	echo "Updating Apple icons..."
	makeDir "$ao/Apple" || return
	$mv "$pp/Apple Software Update.lnk" "$ao/Apple" || return

}

iCloudInstall()
{
	printf "**************************************************\n* iCloud\n**************************************************\n"
	
	run "Apple/iCloud/iCloudSetup.exe" || return # http://support.apple.com/kb/DL1455

	echo "Updating icons..."
	mergeDir "$pp/iCloud" "$oo" || return
	mergeDir "$up/iCloud" "$oo" || return

	echo "Updating registry..."		
	registry delete "urun/AppleIEDAV" || return # C:\Program Files (x86)\Common Files\Apple\Internet Services\AppleIEDAV.exe
	registry delete "urun/ApplePhotoStreams" || return # C:\Program Files (x86)\Common Files\Apple\Internet Services\ApplePhotoStreams.exe
	registry delete "urun/iCloudDrive" || return # C:\Program Files (x86)\Common Files\Apple\Internet Services\iCloudDrive.exe
	registry delete "urun/iCloudServices" || return #  C:\Program Files (x86)\Common Files\Apple\Internet Services\iCloudServices.exe

	appleCore || return

	echot "\
iCloud Control Panel
- uncheck Mail, Contacts, Calendars, & Tasks and Bookmarks
- check Photo Stream"
}

iTunesInstall()
{
	printf "**************************************************\n* iTunes\n**************************************************\n"
	
	run "Apple/iTunes/setup/iTunes64Setup.exe" || return # http://itunes.com

	echo "Updating icons..."
	$rm "$pd/iTunes.lnk" || return
	mergeDir "$pp/iTunes" "$ao" || return

	QuickTimePost || return
	appleCore || return

	echot "\
- iTunes Store, Sign In
- Store, Authorize Computer...
- Notes: Ctrl-t visualizer, ctrl-f full screen"
}

QuickTimePost()
{
	$registry 32 delete "run/QuickTime Task" # "C:/Program Files/QuickTime/qttask.exe" -atboottime

	echo "Updating icons..."
	makeDir "$ao/Apple" || return
	mergeDir "$pp/QuickTime" "$ao" || return
	$rm "$pd/QuickTime Player.lnk" || return
	$mv "$pp/Apple Software Update.lnk" "$ao/Apple" || return
}

TeamViewerInstall()
{
	printf "**************************************************\n* TeamViewer\n**************************************************\n"
	echo "- How do you want to use TeamViewer=personal / non-commercial use"

	run "TeamViewer/setup/TeamViewer_Setup_en.exe" || return # http://www.teamviewer.com/en/download/windows.aspx

	echo "Updating icons..."
	$mv "$pp/TeamViewer "?".lnk" "$pp/Operating System" || return
	$rm "$pd/TeamViewer "?".lnk" || rturn

	echot "\
- Computers & Contacts, Sign In, ...
- Add this computer, Comptuer name=<camel case>, Password/Confirm Password=<secure numeric>"
}

npp() { NotepadPpInstall; }
NotepadPpInstall()
{
	printf "**************************************************\n* Notepad++\n**************************************************\n"
	echo "- Uncheck Run Notepad++"

	# http://notepad-plus-plus.org/download/
	run "Shareware/Notepad++/setup/npp.7.8.6.Installer.x64.exe" --elevate || return

	FindFile "Shareware/Notepad++" || return

	ask "Update plugins" && { RunScriptElevated "rsync -vr --delete $file/setup/plugins \"$P/Notepad++\"" || return; }

	registry import "$file/setup/NotepadPP.reg" || return
	$mv "$pp/Notepad++.lnk" "$pp/Applications" || return
	$rmd "$pp/Notepad++" || return
	$rm "$pd/Notepad++.lnk" || return

	notepadpp profile restore default || return
}

jreInstall()
{
	printf "**************************************************\n* Java Runtime Environment \n**************************************************\n"
	
	# Download 7: http://www.oracle.com/technetwork/java/javase/downloads/index-jsp-138363.html#javasejdk
	# Download: http://www.java.com/en/download/manual.jsp
	# Download: http://www.oracle.com/technetwork/java/javase/downloads/index.html
	# Eary access: http://www.oracle.com/technetwork/java/javase/downloads/ea-jsp-142245.html
	# Test: http://www.java.com/en/download/installed.jsp http://java.com/en/download/help/testvm.xml
	# Services: JavaQuickStarterService
	run "Sun/Java/jre/*-x86.exe" || return
	run "Sun/Java/jre/*-x64.exe" || return

	JavaFinal
}

JavaFinal()
{
	echo "Updating registry..."
	$registry 32 delete "run/SunJavaUpdateSched"
	$registry 64 delete "run/SunJavaUpdateSched"

	echo "Updating icons..."
	JavaIcons || return

	ask "Test the Java browser plugin?" && JavaUtil test
	return 0
}

JavaIcons()
{
		mergeDir "$pp/Java" "$oo" || return
}

hv() { HypervInstall; }
HypervInstall()
{
	#elevate powershell Enable-WindowsOptionalFeature -Online -FeatureName VirtualMachinePlatform
	elevate RunScript --pause-error DISM.exe /Online /Enable-Feature /All /FeatureName:Microsoft-Hyper-V
	pause
	mergeDir "$pp/Administrative Tools" "$pp/Operating System" || return
}

HypervLinuxTools()
{
	( IsPlatform win || ! IsHypervVm ) && return

	package linux-tools-virtual linux-cloud-tools-virtual xrdp || return
	sudo systemctl stop xrdp || return
	sudo systemctl stop xrdp-sesman || return

	local f="/etc/xrdp/xrdp.ini"
	sudo sed -i_orig -e 's/use_vsock=false/use_vsock=true/g' "$f" || return
	sudo sed -i_orig -e 's/security_layer=negotiate/security_layer=rdp/g' "$f" || return
	sudo sed -i_orig -e 's/crypt_level=high/crypt_level=none/g' "$f" || return
	sudo sed -i_orig -e 's/bitmap_compression=true/bitmap_compression=false/g' "$f" || return # fast when local

	[[ ! -e /etc/xrdp/startubuntu.sh ]] && { echo "#!/bin/sh
export GNOME_SHELL_SESSION_MODE=ubuntu
export XDG_CURRENT_DESKTOP=ubuntu:GNOME
exec /etc/xrdp/startwm.sh" | sudo tee /etc/xrdp/startubuntu.sh || return; }

	sudo chmod a+x "/etc/xrdp/startubuntu.sh" || return
	
	sudo sed -i_orig -e 's/startwm/startubuntu/g' "/etc/xrdp/sesman.ini"  || return # setup the ubuntu session
	sudo sed -i -e 's/FuseMountName=thinclient_drives/FuseMountName=shared-drives/g' "/etc/xrdp/sesman.ini"  || return # rename the redirected drives to 'shared-drives'
	sudo sed -i_orig -e 's/allowed_users=console/allowed_users=anybody/g' "/etc/X11/Xwrapper.config" || return

	# Blacklist the vmw module
	[[ ! -e /etc/modprobe.d/blacklist_vmw_vsock_vmci_transport.conf ]] && 
		{ echo "blacklist vmw_vsock_vmci_transport" | sudo tee -a "/etc/modprobe.d/blacklist_vmw_vsock_vmci_transport.conf" || return; }

	#Ensure hv_sock gets loaded
	[[ ! -e /etc/modules-load.d/hv_sock.conf ]] && echo "hv_sock" | sudo tee "/etc/modules-load.d/hv_sock.conf"
	
	# Configure the policy xrdp session
	echo "[Allow Colord all Users]
Identity=unix-user:*
Action=org.freedesktop.color-manager.create-device;org.freedesktop.color-manager.create-profile;org.freedesktop.color-manager.delete-device;org.freedesktop.color-manager.delete-profile;org.freedesktop.color-manager.modify-device;org.freedesktop.color-manager.modify-profile
ResultAny=no
ResultInactive=no
ResultActive=yes" | sudo tee "/etc/polkit-1/localauthority/50-local.d/45-allow-colord.pkla" || return

	# reconfigure the service
	sudo systemctl daemon-reload || return
	sudo systemctl start xrdp || return

	return 0
}

OpenVmTools()
{
	if IsServer; then
		package open-vm-tools || return	
	elif IsDesktop; then
		package open-vm-tools-desktop || return	
	fi

	return 0
}

vmw() { VmwareWorkstationInstall; }
VmwareWorkstationInstall()
{
	printf "**************************************************\n* VMware Workstation\n**************************************************\n"

	# https://my.vmware.com/group/vmware/downloads#tab1
	run "VMware/workstation/" -p "VMware-workstation-full-15.5.5-16285975.exe" "" "VMware-Workstation-Full-15.5.5-16285975.x86_64.bundle" --elevate || return

	echo "Updating icons..."
	mergeDir "$pp/VMware" "$oo" || return
	$rm "$pd/VMware Workstation Pro.lnk" || return
	makeDir "$udata/app/VMware" || return

	echo "Updating firewall..." # When the guest uses NAT echo replies (ICMP type and code 0) must be allowed for ping to function on the guest
	$firewall rule add "VMware NAT Echo Reply" dir=in action=allow enable=yes profile=private,domain localip=any remoteip=any protocol=icmpv4:0,0 interfacetype=any edge=yes || return

	echot "\
- Edit, Preferences...
  - Workspace, Default location for virtual machines=\data\VMware
  - Hotkeys, select Ctrl and Win only
  - Display
    - uncheck Autofit Window
    - check Autofit guest
    - uncheck Show toolbar edge when unpinned in full screen
  - Updates, check Automatically update VMware Tools on a virtual machine"
	# Start manually as default location folder is not yet configured
	start --wait "$P32/VMware/VMware Workstation/vmware.exe" || return
}

DashLane()
{
	printf "**************************************************\n* Dashlane\n**************************************************\n"
	run "Dashlane/Dashlane/" -p "Inst.exe" ".dmg" "linux" || return # https://www.dashlane.com/download#downloaded

	if [[ "$PLATFORM" == "win" ]]; then	
		echo "Updating icons..."
		mergeDir "$up/DashLane" "$oo" || return
		$rm "$ud/Dashlane.lnk" || return
	fi
}

LastPassInstall() # LastPass for Linux only installs Chrome extension
{
	printf "**************************************************\n* LastPass\n**************************************************\n"
	
	# https://lastpass.com/misc_download2.php
	run "LastPass/setup/" -p "LastPassInstaller.exe" "LastPass.dmg" "lplinux.tar.bz2" --elevate || return 

	if IsPlatform linux; then
		cd "$P/lplinux" || return
		./install_lastpass.sh || return
	elif IsPlatform win; then
		mergeDir "$pp/LastPass" "$oo" || return
		$rm "$pd/My LastPass Vault.lnk" || return
		$registry 32 delete "run/LastApp" # C:\Program Files (x86)\LastPass\lastapp.exe
	fi

		return 0
}

iExplorerInstall()
{
	printf "**************************************************\n* iExplorer\n**************************************************\n"
	
	run "Macroplant/iExplorer/setup/" -p "iExplorer_Setup_3401.exe" "iExplorer-3.5.0.6.dmg" ""|| return # http://www.macroplant.com/iexplorer/download-ie3-pc.php

	if [[ "$PLATFORM" == "win" ]]; then
		echo "Updating registry..."	
		$registry delete "urun/iExplorer" # "C:\Program Files (x86)\iExplorer\iExplorer.exe" /background

		echo "Updating icons..."
		mergeDir "$pp/iExplorer" "$oo" || return
		$rm "$oo/iExplorer/Uninstall iExplorer.lnk" || return
			$rm "$oo/iExplorer/iExplorer on the Web.url" || return
		QuickTimePost || return
  elif [[ "$PLATFORM" == "mac" ]]; then
		run "Shareware/Fuse/setup/osxfuse-2.7.1.dmg" || return # http://osxfuse.github.io
	fi
}

PicasaInstall()
{
	printf "**************************************************\n* Picasa\n**************************************************\n"
	
	echot "\
- Completing the Picasa 3 Setup
  - Uncheck Google as my default search engine in Internet Explorer
  - Uncheck Send anonymous usage stats to Google
- Only search My Documents, My Pictures, and Desktop
- Select Don't use Picasa Photo Viewer"

	run "Google/Picasa/setup/Picasa Setup v3.9.139.161.exe" || return
	run "Google/Picasa/starter/image v2.0.zip" "$P32/PicasaStarter" || return

	echo "Updating icons..."
	mergeDir --rename "$pp/Picasa 3" "$pp/Media/Other/Picasa" || return
	mergeDir "$up/Google+ Auto Backup" "$up/Operating System/Other" || return
	$rm "$pp/Media/Other/Picasa/Uninstall.lnk" || return
	$rm "$pd/Picasa 3.lnk" || return
	$makeShortcut "$P32/PicasaStarter/PicasaStarter.exe" "$pp/Media/Other/Picasa/Picasa Starter" || return

	echot "Tools, Options
- General
	- Check Single-click to exit Edit View
	- Delete from disk without confirmation
	- Check Remove from album without confirmation
- E-Mail, E-mail program=Use my Google account
- File Types, select .PNG
- Name Tags, check Store name tags in photo"	
	picasa || return
	pause
}

fsviewInstall() { FastStoneImageViewerInstall; }
FastStoneImageViewerInstall()
{
	printf "**************************************************\n* FastStone Image Viewer\n**************************************************\n"

	run "Shareware/FastStoneImageViewer/setup/FSViewerSetup53.exe" || return

	echo "Updating icons..."
	$rmd "$pp/FastStone Image Viewer" || return
	$mv "$pd/FastStone Image Viewer.lnk" "$pp/Media" || return

		echot "Settings, Settings (F12)
	- Viewer
		- uncheck Confirm on ESC exit
		- uncheck Confirm on overwriting files
		- uncheck Auto-Load next image in Crop Board
		- Single File Deleted to=Recyle-Bin, No Confirmation
	- Dual Monitor, check "Preview" on the secodary monitor
	- Associations, Select All
	- Favorites, Add, P:(\\NAS\Photo), Display Name=NAS"
	fsview start || return
}

irfanInstall() { IrfanViewInstall; }
IrfanViewInstall()
{
	printf "**************************************************\n* IrfanView\n**************************************************\n"
	
	run "Shareware/IrfanView/setup/iview451_x64_setup.exe" || return
	run "Shareware/IrfanView/setup/irfanview_plugins_436_setup.exe" || return
	
	echo "Updating icons..."
	mergeDir "$up/IrfanView" "$pp/Media/Other" || return
	$rm "$ud/IrfanView 64.lnk" || return
	$rm "$ud/IrfanView 64 Thumbnails.lnk" || return
}

CalibreInstall()
{
	printf "**************************************************\n* Calibre\n**************************************************\n"
	[[ "$PLATFORM" == "win" ]] && echo "- Advanced, uncheck Add install directory to path"

	local v=2.57.1 # http://calibre-ebook.com/download
	run "Shareware/Calibre/setup/" -p "calibre-64bit-$v.msi" "calibre-$v.dmg" || return

	if [[ "$PLATFORM" == "win" ]]; then	
		echo "Updating icons..."
		mergeDir --rename "$pp/calibre 64bit - E-book Management" "$ao/calibre" || return
		$rm "$pd/calibre 64bit - E-book management.lnk" || return
	fi

	echot "\
	- choose a location for your books=\\nas\home\documents\data\books
	- Manufacturers=Amazon, Devices=Kindle PaperWhite
	- E-Book Viewer, Configure, General, Page Flip options, Page flip duration=disabled
	- Notes: 
	  - Organizes library folders by <author>/<book> on import or metadata change
	  - Search uses regular expressions: not mobi and not pdf and not azw
	  - Import content from the download directory using the Add books button (content
	    is copied to the ebook location)"
}

Calibre2opdsInstall()
{
	printf "**************************************************\n* calibre2opds\n**************************************************\n"
	run "Shareware/Calibre/calibre2opds/setup/calibre2opds-3.3-253.zip" "$P/calibre2opds" || return # http://calibre2opds.com/downloads/

	echo "Updating icons..."
	$makeShortcut "$P/calibre2opds/rungui.cmd" "$pp/Media/calibre2opds - OPDS Catalog Generator" "-" "" "" min || return
	# cmd "/c /"$P/calibre2opds/rungui.cmd/""  "" 
	# --workingdir="$(utw "$P/calibre2opds")"
}

KindleInstall()
{
	printf "**************************************************\n* Kindle\n**************************************************\n"
	run "Amazon/Kindle/setup/KindleForPC-installer-1.16.44025.exe" || return # http://www.amazon.com/gp/kindle/mac/download http://www.amazon.com/gp/kindle/pc/download
	run "Amazon/Kindle/converter/Kindle DRM Removal v4.16.525.exe" || return # http://www.ebook-converter.com/kindle-drm-removal.htm

	echo Creating data folders...
	makeDir "$udata/Kindle" || return
	makeDir "$udata/eBook Converter" || return
	makeDir "$udoc/eBook Converter" || return
	$hide "$udoc/eBook Converter" || return

	echo "Updating icons..."
	mergeDir "$pp/Amazon" "$ao" || return
	mergeDir "$up/Amazon" "$ao" || return
	mergeDir --rename "$ao/Amazon/Amazon Kindle" "$ao/Amazon/Kindle" || return
	$rm "$pd/Kindle.lnk" || return
	$rm "$ud/Kindle.lnk" || return
	$rm "$ao/Amazon/Kindle/Uninstall Kindle.lnk" || return
	
	mergeDir "$pp/eBook Converter" "$ao" || return

	echot "\
Kindle for PC
- Tools, Options
  - General, uncheck Automatically install updates
  - Content, Change Folder, data/Kindle

- Kindle DRM Reoval
  - Output Option, Set Output Folder, Documents/data/Kindle DRM
  - Kindle, Kindle Serial Number=NNN"
	start "https://www.amazon.com/gp/digital/fiona/manage?ie=UTF8&ref_=sv_kinc_7&signInRedirect=1&#manageDevices"
	kindle start || return
	kindle decrypt || return
}

HarmonyRemoteInstall()
{
	printf "**************************************************\n* Harmony Remote\n**************************************************\n"
	run "Logitech/Harmony Remote/LogitechHarmonyRemote7.7.0-WIN-x86.exe" || return # http://www.logitech.com/en-us/440/6441?section=downloads&bit=&osid=14

	echo "Updating icons..."
	mergeDir "$pp/Logitech" "$ao" || return
	$rm "$pd/Logitech Harmony Remote Software 7.lnk" || return
}

VeraCryptInstall()
{
	printf "**************************************************\n* VeraCrypt\n**************************************************\n"
	local v="1.16" # https://veracrypt.codeplex.com/wikipage?title=Downloads

	run "Shareware/VeraCrypt/setup/" -p "VeraCrypt Setup $v.exe" "VeraCrypt_${v}.dmg" "veracrypt-$v-setup" || return 

	makeDir "$UserHome/Documents/data/VeraCrypt" || return

	if [[ "$PLATFORM" == "win" ]]; then
		echo "Updating icons..."
		mergeDir "$pp/VeraCrypt" "$ao" || return
		$rm "$pd/VeraCrypt.lnk" || return
	fi

	echot "\
- Settings, Hot Keys...
	- Mount Favorite Volumes - Control+Shift+Alt+F2
	- Dismount All - Control+Shift+Alt+F3
	- Force Dismount All, Wipe Cache & Exit - Control+Shift+Alt+F4
- Settings, Preferences
	- Uncheck Preserve modification timestamp of file containers
	- Check Cache passwords in driver memory
	- Uncheck Wipe cached passwords on auto-dismount and exit
- Select File..., data/VeraCrypt, personal.tc, Mount
- Favorites, Add Mounted Volumes to Favorites...
	- Label of selected favorite volume=Personal"
	#start 4ard VeraCrypt start
}

FLuxInstall()
{
	printf "**************************************************\n* f.lux\n**************************************************\n"
	run "Shareware/f.lux/" -p "flux-setup.exe" "Flux.zip" "" || return # http://justgetflux.com/	

	echo "Updating icons..."
	mergeDir "$up/Flux" "$up/Operating System/Other" || return

	echo "Updating registry..."	
	$registry delete "urun/f.lux" # "C:\Users\jjbutare\AppData\Local\FluxSoftware\Flux\flux.exe" /noshow

	echot "\
- Location: Search
- Transition: Slow
- check Start F.lux at Login"
	[[ "$PLATFORM" == "mac" ]] && { start "/Applications/Flux.app" || return; }
}

ParallelsDesktopInstall()
{
	printf "**************************************************\n* Parallels Desktop\n**************************************************\n"

	# http://www.parallels.com/downloads/desktop/
	run "Parallels Desktop/setup/ParallelsDesktop-15.1.4-47270.dmg" || return

	echo "Updating icons..."
	$rm "$la\com.parallels.mobile.prl_deskctl_agent.launchagent.plist" || return
	$rm "$ula\com.parallels.mobile.startgui.launchagent.plist" || return

	echot "\
- Preferences
	- Shortcuts
		- System Shortcuts, Send system shortcuts=Always
		- Profile=Windows Custom - based on Windows, uncheck all
		add cmd-down=Ctrl+End cmd-up=Ctrl+Home ctrl-option-right=Win+Right 
		ctrl-option-left=Win+Left
- Virtual Machine, Configure...
	- Options
		- Startup and Shutdown, On VM Shutdown=Close Window
		- Applications
			- check Show Dock icons in Coherence only
			- uncheck Dock icons bounce to alert
		- Full Screen, check Use all displays in full screen
	- Hardware
		- Mouse & Keyboard, uncheck Mouse pointer sticks at window edges
		- Network 1, Type=Bridge, Default adapter
	- Security, check Do not back up virtual machine"
}

ChocolateyInstall()
{
	printf "**************************************************\n* choclatey\n**************************************************\n"
	# installs: user environment path=c:\Chocolatey\bin, ChocolateyInstall=c:\Chocolatey
	start --wait cmd /c powershell -NoProfile -ExecutionPolicy unrestricted -Command "iex ((new-object net.webclient).DownloadString('https://chocolatey.org/install.ps1'))" "&&" pause
}

WindowsAdministrationToolsInstall()
{
	printf "**************************************************\n* Windows Administration Tools\n**************************************************\n"
	run "Microsoft/Server/tools/WindowsTH-RSAT_WS_1803-x64.msu" || return # http://www.microsoft.com/en-us/search/result.aspx?q=Remote%20Server%20Administration%20Tools&form=DLC

	echo "Updating icons..."
	mergeDir "$pp/Administrative Tools" "$oo" || return
	$rm "$pp/Server Manager.lnk" || return
	$rm "$pp/Administrative Tools.lnk" || return
}

MosaicoInstall()
{
	printf "**************************************************\n* Mosaico\n**************************************************\n"
	echo "- uncheck Launch Mosaico"

	run "Soulid Studio/Mosaico/setup/Mosaico Setup v1.9.0.0.exe" || return # http://www.soulidstudio.com/download/

	echo "Updating icons..."
	mergeDir "$pp/Mosaico" "$oo" || return

	echo "Updating registry..."	
	$registry delete "urun/Mosaico" # C:\Program Files (x86)\Mosaico\mosaico.exe

	echot "\
- Try Mosaico for Free!
- unselect Auto Place
- Settings
	- uncheck Always on top of other windows
	- uncheck Display info message when reduced to system tray
	- check Start minimized to system tray
	- uncheck Start with "auto place" turned on
	- uncheck Tabify when not active
	- Show quick guide at startup"
	mosaico start
}

ccInstall() { CreativeCloudInstall; }
CreativeCloudInstall()
{
	local copyLocal

	printf "**************************************************\n* Adobe Creative Cloud\n**************************************************\n"
	
	# https://creative.adobe.com/products/creative-cloud
	IsPlatform win && copyLocal="--copy-local"
	run "Adobe/Creative Cloud/setup/" -p "Creative_Cloud_Set-Up.exe" "Creative_Cloud_Installer.dmg" "" $copyLocal || return

	if [[ "$PLATFORM" == "win" ]]; then	
		echo "Updating icons..."
		makeDir "$pp/Media/Other/Adobe" || return
		$mv "$pp/Adobe"*".lnk" "$pp/Media/Other/Adobe" >& /dev/null
		$mv "$pd/Adobe"*".lnk" "$pp/Media/Other/Adobe" >& /dev/null

		$registry 32 delete "run/Adobe Creative Cloud" # "C:\Program Files (x86)\Adobe\Adobe Creative Cloud\ACC\Creative Cloud.exe" --showwindow=false --onOSstartup=true
		$registry 32 delete "run/Acrobat Assistant 8.0" # "C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\Acrotray.exe"
		$registry delete "run/AdobeGCInvoker-1.0" # "C:\Program Files (x86)\Common Files\Adobe\AdobeGCClient\AGCInvokerUtility.exe"
		$registry delete "urun/Adobe Acrobat Synchronizer" # "C:\Program Files (x86)\Adobe\Acrobat DC\Acrobat\AdobeCollabSync.exe"

		$registry delete "HKCU/SOFTWARE/Microsoft/Windows/CurrentVersion/Explorer/Desktop/NameSpace/{0E270DAA-1BE6-48F2-AC49-30EDF67ECDE9}/" # Desktop Creative Cloud icon
		$registry set "HKCU/Software/Classes/CLSID/{0E270DAA-1BE6-48F2-AC49-30EDF67ECDE9}/System.IsPinnedToNameSpaceTree" REG_DWORD 0 || return # Desktop Creative Cloud icon

		makeLink --merge "$udata/app/Creative Cloud Files" "$WIN_HOME/Creative Cloud Files" || return
		makeLink --merge --hide "$udata/app/Adobe" "$udoc/Adobe" || return
	fi
}

ProxifierInstall()
{
	printf "**************************************************\n* Proxifier\n**************************************************\n"
	run "Proxifier/setup/" -p "ProxifierSetup.exe" "Proxifier.app.zip" "" || return # http://www.proxifier.com/download.htm https://intelpedia.intel.com/Proxifier


	FindFile "Proxifier/profiles/Intel Custom.ppx" || return
	clipw "$file" || return	
	echot "\
- File, Import, <paste>"
}

IntuosProInstall()
{
	printf "**************************************************\n* Intuos Pro\n**************************************************\n"
	run "Intuos/Pro/setup/WacomTablet_6.3." -p "16-2.exe" "15-3.dmg" "" || return # http://us.wacom.com/en/support/drivers/

	if [[ "$PLATFORM" == "win" ]]; then	
		echo "Updating icons..."
		mergeDir "$pp/Wacom Tablet" "$pp/Media/Other" || return
	fi
}

DiskInventortyXInstall()
{
	printf "**************************************************\n* Disk Inventory X\n**************************************************\n"
	run "Shareware/Disk Inventory X" -p "" "DIX1.0Universal.dmg" "" || return # http://www.derlien.com/downloads/index.html
}

RubyInstall()
{
	# ruby
	! InPath ruby && IsPlatform debian,mac && { package ruby || return; }

	# development
	if IsPlatform debian && [[ ! -f /usr/include/ruby-2.5.0/ruby.h ]]; then
		local devPackage="ruby$(ruby -e 'puts RUBY_VERSION[/\d+\.\d+/]')-dev"
		package $devPackage || return		
	fi

	! InPath gcc && { package gcc || return; }
	! InPath make && { package make || return; }
	
	# SSL libraries
	IsPlatform debian && [[ ! -d /usr/include/openssl ]] && { package libssl-dev || return; }

	# create directories
	makeDir ~/.gem && $hide ~/.gem || return

	# update ~/.gemrc
	if IsPlatform mac && ! grep "/usr/local/bin" ~/.gemrc  >& /dev/null; then
		echo "gem: -n/usr/local/bin" >> ~/.gemrc
	fi
}

PythonInstall()
{	
	printf "**************************************************\n* Python\n**************************************************\n"

	# python3
	! InPath python3 && IsPlatform debian,mac && { package python3 || return; }

	# pip3 - https://packaging.python.org/tutorials/installing-packages/ 
	if ! InPath pip3; then

		IsPlatform mac && { python3 -m ensurepip --default-pip || return; }

		# Ubuntu pip3 has issues getting updated packages, but needs to be installed for get-pip to work
		if IsPlatform ubuntu; then	
			package python3-pip || return
			packageu python3-pip || return
		fi

		! InPath pip3 && { sudo -H python3 "$BIN/get-pip.py" || return; }
	fi

	if IsPlatform debian; then
		package python3-dev libcairo2-dev libgirepository1.0-dev || return
		sudo -H pip3 install --ignore-installed httplib2 pyasn1-modules pygobject pyxdg PyYAML || return # fix issues updating packages
	fi

	if IsPlatform win && [[ ! -d ~/.cache || ! -d ~/.pip ]]; then
		echo "Creating directories..."
		makeDir ~/.cache ~/.pip || return
		$hide ~/.cache ~/.pip || return
	fi

	return 0
}

SevenZip()
{
	printf "**************************************************\n* 7-Zip\n**************************************************\n"
	
	# http://www.7-zip.org/download.html
	run "Shareware/7-Zip/setup/7z1900-x64.exe" --elevate || return

	# Update bin files
	$cp "$P/7-zip/7-zip.chm" "$DATA/platform/win" || return
	$cp "$P/7-zip/7z.exe" "$P/7-zip/7z.dll" "$DATA/platform/win" || return

	echo "Updating icons..."
	mergeDir "$pp/7-Zip" "$ao" || return

	clipw "$(utw "$P/Sublime Text 3/sublime_text.exe")" || return
	echot "\
- Tools, Options
	- System, above $USER click +
	- Editor
 		- View=Editor=<paste>
		- Diff=C:\Program Files\Beyond Compare 4\BComp.exe
	- Settings, check Show system menu"
  "$P/7-Zip/7zFM.exe" || return
}

PaintNetInstall()
{
	printf "**************************************************\n* paint.net\n**************************************************\n"
	run "Shareware/paint.net/setup/paint.net.4.0.6.install.exe" || return # http://www.getpaint.net/

	if [[ "$PLATFORM" == "win" ]]; then	
		echo "Updating icons..."
		$mv "$pp/paint.net.lnk" "$pp/Media" || return
		$rm "$pd/paint.net.lnk" || return
	fi
}

FiddlerInstall()
{
	printf "**************************************************\n* Fiddler\n**************************************************\n"

	# http://www.telerik.com/fiddler
	run "Telerik/Fiddler/" -p "Fiddler Everywhere 0.10.0.exe" "fiddler-mac.zip" "fiddler-linux.zip" || return

	if [[ "$PLATFORM" == "win" ]]; then	
		echo "Updating icons..."
		$mv "$up/Fiddler Everywhere.lnk" "$up/Development" || return
		$rm "$ud/Fiddler Everywhere.lnk" || return
	fi
}

LinqPadInstall()
{
	printf "**************************************************\n* LINQPad\n**************************************************\n"
	run "Shareware/DOT.NET/LinqPad/LINQPad5Setup.exe" || return # https://www.linqpad.net/Download.aspx

	echo "Moving data folders..."
	makeDir "$udata/LINQPad" || return
	makeLink --merge --hide "$udata/LINQPad" "$udoc/LINQPad Queries" || return

	echo "Updating icons..."
	$mv "$ud/LINQPad 5.lnk" "$pp/Development/DotNet" || return
	$rmd "$pp/LINQPad" || return
}

MusicBeeInstall()
{
	[[ "$PLATFORM" != "win" ]] && return 0;
	printf "**************************************************\n* MusicBee\n**************************************************\n"
	run "Shareware/MusicBee/setup/MusicBeeSetup_3_0_Update1.exe" || return # http://getmusicbee.com/download.html

	if [[ "$PLATFORM" == "win" ]]; then	
		echo "Updating icons..."
		mergeDir "$up/MusicBee" "$pp/Media/Other" || return
		$rm "$ud/MusicBee.lnk" || return
	fi

	echot "\
- Cancel"
}

DymoInstall()
{
	printf "**************************************************\n* Dymo Label\n**************************************************\n"

	# http://www.dymo.com/en-US/dymo-user-guides
	run "hardware/DYMO/" -p "DCDSetup1.3.1.exe" "DLS8Setup.8.7.4.dmg" "" --elevate || return 

	if [[ "$PLATFORM" == "win" ]]; then	
		mergeDir "$pp/DYMO" "$ao" || return
		$rm "$pd/DYMO Connect.lnk" || return

		$registry 32 delete "run/DymoOfficeHelper" # "C:\Program Files (x86)\DYMO\DYMO Connect\DYMO.OfficeHelper.exe" /w
		$registry 32 delete "run/DYMOWebApi" # "C:\Program Files (x86)\DYMO\DYMO Connect\DYMO.WebApi.Win.Host.exe" /auto
		$registry delete "urun/DYMOConnectLauncher" # "C:\Program Files (x86)\DYMO\DYMO Connect\DYMOConnectLauncher.exe"
	fi

	return 0
}

DuetDisplay()
{
	printf "**************************************************\n* Duet Display\n**************************************************\n"

	# https://www.duetdisplay.com/#download
	run "hardware/duet/" -p "DuetSetup-1-8-2-1.exe" "duet-2-3-0-5.zip" "" --elevate || return

	case "$PLATFORM" in

		win) 
			mergeDir "$pp/Duet Display" "$oo" || return
			$rm "$pd/duet.lnk" || return
			$registry 32 delete "run/Duet Display" # C:\Program Files\Kairos\Duet Display\duet.exe
			;;

	esac

	return 0
}

TidalInstall()
{
	printf "**************************************************\n* TIDAL\n**************************************************\n"
	run "TIDAL/TIDALSetup." -p "exe" "dmg" "" || return

	if [[ "$PLATFORM" == "win" ]]; then	
		echo "Updating icons..."
		mergeDir "$up/TIDAL" "$up/Media/Other" || return
		$rm "$ud/TIDAL.lnk" || return
	fi
}

OpcScoutInstall()
{
	printf "**************************************************\n* OPC Scout\n**************************************************\n"
	run "Siemens/setup/OPCScoutV10.zip" "$P32/OPCScoutV10" || return

	echo "Updating icons..."
	MakeShortcut "$P32/OPCScoutV10/OPCScoutV10.exe" "$pp/Development/OPC Scout.lnk" || return	
}

MatrikonOpcSimulatorInstall()
{
	printf "**************************************************\n* Matrikon OPC Simulator\n**************************************************\n"
	run "Matrikon/setup/MatrikonOPCSimulation.EXE" || return

	echo "Updating icons..."
	mergeDir "$pp/MatrikonOPC" "$up/Development/Other" || return
}
	
GrayboxOpcInstall()
{
	printf "**************************************************\n* Graybox OPC \n**************************************************\n"
	run "Graybox/setup/gbopcsim18.msi" || return # http://gray-box.net/opc_simulator.php

	echo "Updating icons..."
	mergeDir "$pp/Graybox" "$up/Development/Other" || return
}

IntelDriverUpdateInstall()
{
	printf "**************************************************\n* Intel Driver Update \n**************************************************\n"

	# https://www-ssl.intel.com/content/www/us/en/support/detect.html
	run "Intel/driver/Intel-Driver-and-Support-Assistant-Installer.exe" --elevate /q || return

	IntelIcons || return
}

IntelDrivers()
{
	local a=(--elevate --no-pause)

	printf "**************************************************\n* Intel Drivers \n**************************************************\n"
	run "Intel/driver/WiFi/WiFi_21.80.2_Driver64_Win10/Netwtw08.INF" || return # https://downloadcenter.intel.com/download/29124/Intel-PROSet-Wireless-Software-and-Drivers-for-IT-Admins
	run "Intel/driver/Bluetooth/BT_21.80.0_64_Win10/Intel Bluetooth.msi" --elevate --no-pause || return # https://downloadcenter.intel.com/download/29126/
	run "Intel/driver/Serial IO/SerialIO_30.100.1915.1_PV_CNL_19H1/SetupSerialIO.exe" -s || return # rosie
	i IntelStorageManagement ThunderboltControlCenter IntelIcons || return
}

IntelIcons()
{
	makeDir "$oo/Intel" || return	

	MergeDir --suppress "$pp/Intel" "$oo" || return

	mv "$pp/Intel Driver "*" Support Assistant.lnk" "$oo/Intel/Intel Driver Update.lnk" >& /dev/null
	$mv "$ud/Intel(R) Processor Identification Utility.lnk" "$oo/Intel" || return

	$registry 32 delete "run/Intel Driver \& Support Assistant" || return # C:\Program Files (x86)\Intel Driver and Support Assistant\DsaTray.exe
}

IntelProcessorIdentificationUtilityInstall() { run "Intel/other/Intel(R) Processor Identification Utility.exe"; IntelIcons; }
IntelStorageManagementInstall() { StoreInstall "Intel Storage Management" "9MZNG5HZWZ1T"; }
ThunderboltControlCenterInstall() { StoreInstall "Thunderbolt Control Center" "9N6F0JV38PH1"; }

GameIcons()
{
	echo "Moving data folders..."
	makeLink --merge --hide "$udata/app/Shadow of the Tomb Raider" "$udoc/Shadow of the Tomb Raider" || return

	echo "Updating icons..."	
	$mv "$ud/Rockstar Games Launcher.lnk" "$pp/Game" || return
	
	$mv "$ud/The Elder Scrolls V Skyrim VR.url" "$pp/Game" || return
	$mv "$ud/Far Cry 5.url" "$pp/Game" || return	
	$mv "$ud/Fortnite.url" "$pp/Game" || return	
	$mv "$ud/Grand Theft Auto V.url" "$pp/Game" || return	
	$mv "$ud/Half-Life 2 Lost Coast.url" "$pp/Game" || return
	$mv "$ud/Half-Life Alyx.url" "$pp/Game" || return	
	$mv "$ud/Hot Dogs, Horseshoes & Hand Grenades.url" "$pp/Game" || return
	$mv "$ud/Jurassic World Evolution.url" "$pp/Game" || return
	$mv "$ud/Middle-earth Shadow of Mordor.url" "$pp/Game" || return
	$mv "$ud/realMyst Masterpiece Edition.url" "$pp/Game" || return
	$mv "$ud/NBA 2K17.url" "$pp/Game" || return
	$mv "$ud/Ravenfield.url" "$pp/Game" || return
	$mv "$ud/Shadow of the Tomb Raider.url" "$pp/Game" || return
	$mv "$ud/STAR WARS Jedi Fallen Orderâ„¢.url" "$pp/Game" || return
	$mv "$ud/The Witness.url" "$pp/Game" || return	
	$mv "$ud/Tom Clancy's Rainbow Six Siege.url" "$pp/Game" || return	
}

SteamInstall()
{
	printf "**************************************************\n* Steam\n**************************************************\n"
	run "game/Steam/" -p "SteamSetup.exe" "steam.dmg" "steam_latest.deb" --elevate || return # http://store.steampowered.com/about/
	
	if IsPlatform win; then
		$registry delete "urun/Steam" # Steam	Steam Client Bootstrapper	Valve Corporation, c:\program files (x86)\steam\steam.exe
		mergeDir "$up/Steam" "$pp/Game/Other" || return
		mergeDir "$pp/Steam" "$pp/Game/Other" || return
		$rm "$pd/Steam.lnk" || return
		makeLink --merge --hide "$udata/app/Steam VR" "$udoc/steamvr" || return
		GameIcons || return
	fi

	return 0
}

OriginInstall()
{
	printf "**************************************************\n* Origin Games\n**************************************************\n"

	# https://www.origin.com/usa/en-us/store/download
	run "game/Origin/" -p "OriginThinSetup.exe" "Origin.dmg" "" || return

	if [[ "$PLATFORM" == "win" ]]; then
		$registry delete "urun/EADM" # "C:\Program Files (x86)\Origin\Origin.exe" -AutoStart
		mergeDir "$pp/Origin" "$pp/Game/Other" || return
		$rm "$pd/Origin.lnk" || return
	fi

	return 0
}

EpicGamesInstall()
{
	printf "**************************************************\n* Epic Games\n**************************************************\n"
	run "game/Epic Games/EpicInstaller-7.9.0.msi" || return # https://www.epicgames.com/account/personal#

	echo "Updating icons..."
	$mv "$pp/Epic Games Launcher.lnk" "$pp/Game/Other" || return
	$rm "$pd/Epic Games Launcher.lnk" || return
	GameIcons || return
}

UplayInstall()
{
	printf "**************************************************\n* UPlay (UbiSoft)\n**************************************************\n"
	run "game/Ubisoft/UplayInstaller.exe" || return #

	echo "Updating icons..."
	mergeDir "$up/Ubisoft" "$pp/Game/Other" || return
	$rm "$ud/Uplay.lnk" || return

	echo "Moving data folders..."
	makeLink --merge --hide "$udata/app/Uplay" "$udoc/My Games" || return
}

GreenShot()
{
	printf "**************************************************\n* GreenShot\n**************************************************\n"

	# http://getgreenshot.org/downloads/
	run "Shareware/Greenshot/setup/" -p "Greenshot-INSTALLER-1.2.10.6-RELEASE.exe" "1103915944" "" /silent || return

	if IsPlatform win; then
		mergeDir "$pp/GreenShot" "$oo" || return
		$registry delete "run/Greenshot" # C:\Program Files\Greenshot\Greenshot.exe

	elif IsPlatform mac && askP "Do you want to configure GreenShot"; then
		echo "System Preferences, Security & Privacy, Screen Recording, check Greenshot"
		MacAppOpen "$1" || return
		pause
	fi

	return 0
}

PartitionAssistantInstall()
{
	printf "**************************************************\n* Partition Assistant\n**************************************************\n"
	
	# https://www.aomeitech.com/pa/professional.html?ref=en.nav.partition-manager
	run "AOMEI/Partition Assistant/PAssist_ProDemo.exe" --elevate || return 

	mergeDir --rename "$pp/AOMEI Partition Assistant" "$oo/Partition Assistant" || return
	$ren "$oo/Partition Assistant/AOMEI Partition Assistant Demo Edition "*".lnk" "$oo/Partition Assistant/Partition Assistant.lnk" || return
	$rm "$pd/AOMEI Partition Assistant"*".lnk" || return
}

icue() { CorsairUtilityEngine; };
CorsairUtilityEngine()
{
	printf "**************************************************\n* Corsair Utility Engine (CUE)\n**************************************************\n"
	run "hardware/Corsair/Utility Engine/iCUESetup_3.28.75_release.msi" || return # https://www.corsair.com/us/en/downloads

	$mv "$pd/iCUE.lnk" "$pp/Operating System" || return
	$rmd "$psm/Corsair" || return
	$registry 32 delete "run/CORSAIR iCUE Software" # "C:\Program Files (x86)\Corsair\iCUE\iCUE Launcher.exe" --autorun
	service stop CorsairService || return # high CPU
}

LogitechOptions()
{
	printf "**************************************************\n* Logitech Options\n**************************************************\n"

	# http://support.logitech.com/en_us/software/options
	if IsPlatform mac; then
		# the macOS zip file contains an installation program, if this pattern repeats add a -run option that is passed to InstallAppFromZip, for macOS no argument is needed, unzip to $TEMP
		FindFile "hardware/Logitech/options/LogiMgr Installer 8.10.64.app" || return
		open -a "$file" || return
		pause
	else
		run "hardware/Logitech/options/Options_8.10.154.exe" --elevate || return
	fi

	if IsPlatform win; then
		$mv "$pp/Logitech/Logitech Options.lnk" "$pp/Operating System" || return
		$rmd "$pp/Logitech" || return
		$registry delete "run/LogiOptions" # C:\Program Files\Logitech\LogiOptions\LogiOptions.exe /noui
		$registry delete "run/Logitech Download Assistant" # C:\Windows\system32\rundll32.exe C:\Windows\System32\LogiLDA.dll,LogiFetch
	
		#profile --app "LogitechOptions" --method "$APPDATA/Logishrd/LogiOptions" --files "*" save default
		#ProcessKill LogiOptionsMgr.exe >& /dev/null; ProcessKill LogiOverlay.exe >& /dev/null
		profile --app "LogitechOptions" --method "$APPDATA/Logishrd/LogiOptions" restore || return
	fi

	return 0
}

GlassWire()
{
	printf "**************************************************\n* GlassWire\n**************************************************\n"
	run "GlassWire/GlassWireSetup.exe" --elevate || return # https://www.glasswire.com/download/

	$registry delete "urun/GlassWire" # "C:\Program Files (x86)\GlassWire\glasswire.exe" -hide
	mergeDir "$pp/GlassWire" "$oo" || return
	$rm "$pd/GlassWire.lnk" || return

	echot "\
- Show Mini Viewer
- Activate GlassWire"
}

MsiMotherboard()
{
	printf "**************************************************\n* MSI Motherboard\n**************************************************\n"
	run "install/hardware/MSI/MSI PRESTIGE 15 A10SC-011/Creator Center/v1.1.1911.0501_1.1.1911.0501/Setup.exe" || return

	mergeDir "$pp/MSI" "$oo" || return	
}

GigabyteMotherboard()
{
	local d="hardware/Gigabyte/utility" a=(--elevate --no-pause)

	printf "**************************************************\n* Gigabyte Motherboard\n**************************************************\n"

	# Designare EX: https://www.gigabyte.com/us/Motherboard/X299-DESIGNARE-EX-rev-10#support-dl
	# RGB Fusion: https://www.gigabyte.com/MicroSite/512/download.html
	# motherboard: https://www.gigabyte.com/us/Support/Utility/Motherboard (advanced search, chipset=Intel X299)
	run "$d/Application Center vB20.0219.1/Setup.exe" "${a[@]}" || return 
	run "$d/RGB Fusion vB20.0430.1/UpdPack.exe" "${a[@]}" || return
	run "$d/Easy Tune vB19.1202.1/setup.exe" "${a[@]}" || return # B20.0214.1
	run "$d/System Information Viewer vB20.0409.1/setup.exe" "${a[@]}" || return # B20.0410.1
	run "$d/AT BIOS vB20.0406.1/setup.exe" "${a[@]}" || return # B20.0422.1
	run "$d/BIOS Setup vB17.0621.1/setup.exe" "${a[@]}" || return
	run "$d/Fast Boot vB17.0619.1/setup.exe" "${a[@]}" || return
	run "$d/V-Tuner vB17.0616.1/setup.exe" "${a[@]}" || return

	$registry delete "run/RtkAudUService" # "C:\WINDOWS\System32\RtkAudUService64.exe" -background
	$registry delete "run/RTHDVCPL" # "C:\Program Files\Realtek\Audio\HDA\RtkNGUI64.exe" -s

	d="$oo/GIGABYTE"
	mergeDir "$pp/GIGABYTE" "$oo" || return

	# Application Center
	$registry 32 delete "RunOnce/PreRun" # C:\Program Files (x86)\GIGABYTE\AppCenter\PreRun.exe
	mv "$d/APP Center/"* "$d" >& /dev/null
	rm -fr "$d/APP Center" || return
	[[ -f "$d/Launch APP Center.lnk" ]] && { mv "$d/Launch APP Center.lnk" "$d/GIGABYTE Application Center.lnk" || return; }

	# System Information Viewer
	mv "$d/SIV/"* "$d" >& /dev/null
	rm -fr "$d/SIV" || return

	# EasyTune
	makeLink --merge --hide "$udata/app/EasyTune" "$udoc/EasyTune" || return
	mv "$d/EasyTune/"* "$d" >& /dev/null
	rm -fr "$d/EasyTune" || return

	# @BIOS
	mv "$d/@BIOS/"* "$d" >& /dev/null
	rm -fr "$d/@BIOS" || return

	# RGB Fusion
	$registry 32 delete "RunOnce/SelLed" # C:\Program Files (x86)\GIGABYTE\RGBFusion\RunLed.exe
	mv "$pp/AORUS/RGBFusion 2.0/"* "$d" >& /dev/null
	rm -fr "$pp/AORUS" || return
	$rm "$pd/RGBFusion 2.0.lnk" || return
	$mv "$d/RGBFusion 2.0.lnk" "$d/RGB Fusion.lnk" || return

	# other
	$makeShortcut "$P32/GIGABYTE/BIOS Setup/BiosSetupConsole.exe" "$d/BIOS Setup" || return
	$makeShortcut "$P32/GIGABYTE/FastBoot/FastBoot.exe" "$d/Fast Boot.lnk" || return
	$makeShortcut "$P32/GIGABYTE/VTuner/vTuner.exe" "$d/VTuner.lnk" || return

	echot "\
Do not update APP Center
- Preferences
	- Update Schedule=Turn off
	- Uncheck Always run on next reboot"
	elevate "$P32/GIGABYTE/AppCenter/RunUpd.exe" || return
}

EpsonScan()
{
	printf "**************************************************\n* Epson Scan\n**************************************************\n"

	# https://epson.com/Support/Scanners/Perfection-Series/Epson-Perfection-V100-Photo/s/SPT_B11B184051
	run "hardware/Epson/Perfection V100 Photo/epson13833.exe" || return

	mergeDir "$pp/EPSON Scan" "$oo" || return
	$rm "$pd/EPSON Scan.lnk" || return
}

DoxieGo()
{
	printf "**************************************************\n* Doxie Go\n**************************************************\n"
	run "hardware/Doxie/Go/" -p "DoxieSetup_2.11.3.exe" "Doxie_2.11.3.dmg" "" || return # http://help.getdoxie.com/doxiego/

	echo "Updating icons..."
	$mv "$pd/Doxie.lnk" "$pp/Operating System" || return
	$rmd "$pp/Doxie" || return
}

PdfElement()
{
	printf "**************************************************\n* PDFelement\n**************************************************\n"

	# â€‹https://pdf.wondershare.com/
	run "Wondershare/PDFelement/" -p "pdfelement6-pro_setup_full2990.exe" "mac-pdfelement6-pro_full2992.dmg" "" || return

	mergeDir "$pp/Wondershare/" "$pp/Applications/Other" || return
	$rm "$pd/PDFelement 6 Pro.lnk"
}

TigerVnc()
{
	printf "**************************************************\n* TigerVNC\n**************************************************\n"
	echot "- uncheck all Server configuration options"

	# â€‹https://github.com/TigerVNC/tigervnc/releases
	run "Shareware/TigerVNC/" -p "tigervnc64-1.8.0.exe" "" "" || return

	mergeDir --rename "$pp/TigerVNC 64-bit" "$oo/TigerVNC" || return
	$rm "$pd/PDFelement 6 Pro.lnk" || return
}

TidyTabsInstall() 
{ 
	printf "**************************************************\n* TidyTabs\n**************************************************\n"
	
	# https://www.nurgo-software.com/pricing/tidytabs
	run "NURGO/TidyTabs.msi" || return

	echo "Updating icons..."
	mergeDir "$pp/TidyTabs" "$oo" || return

	echo "Updating registry..."	
	$registry delete "urun/TidyTabs" || return; # C:\Program Files (x86)\TidyTabs\TidyTabs.Daemon.exe

	TidyTabs profile restore default || return
}

AquaSnap()
{
	printf "**************************************************\n* AquaSnap\n**************************************************\n"

	# https://www.nurgo-software.com/pricing/aquasnap
	run "NURGO/AquaSnap.msi" || return

	echo "Updating icons..."
	mergeDir "$pp/AquaSnap" "$oo" || return

	echo "Updating registry..."	
	$registry delete "urun/AquaSnap" || return; # C:\Program Files (x86)\AquaSnap\AquaSnap.Daemon.exe

	echot "\
	- Settings...
		- AquaShake, Shaking mode=Disabled
		- Hotkeys, Makimize, Shortcut 2=Win+Clear"
}

Garmin()
{
	printf "**************************************************\n* Garmin\n**************************************************\n"

	run "hardware/Garmin/setup/" -p "GarminExpress.exe" "GarminExpress.dmg" "" || return # GPS - https://www.garmin.com/en-US/software/express/
	run "hardware/Garmin/setup/" -p "BaseCamp_462.exe" "BaseCampforMac_463.dmg" "" || return # GPS - https://www.garmin.com/en-US/shop/downloads/basecamp
	run "hardware/Garmin/setup/" -p "inReach Sync en-US 166572.exe" "" "" || return # satellite - https://inreach.garmin.com/Sync

	mergeDir "$pp/Garmin" "$pp/Travel/Other" || return
	$rm "$pd/Garmin Express.lnk"	
	$rm "$pd/inReach Sync.lnk"	
	makeLink --merge --hide "$udata/app/Garmin" "$udoc/My Garmin" || return
	$registry delete "urun/GarminExpressTrayApp" # "C:\Program Files (x86)\Garmin\Express Tray\ExpressTray.exe"
}

Sena()
{
	printf "**************************************************\n* Sena\n**************************************************\n"
	run "hardware/Sena/setup/" -p "SenaBluetoothDeviceManagerForWindows-v3.8.2-setup_x64.exe" "SENABluetoothDeviceManagerForMAC-v3.7.pkg" "" || return # â€‹https://www.sena.com/software/#device-manager

	echo "Updating icons..."
	mergeDir "$up/Sena Technologies" "$pp/Travel/Other" || return
	$rm "$ud/SenaBluetoothDeviceManager.lnk"	
}

GoPro()
{
	printf "**************************************************\n* GoPro\n**************************************************\n"
	
	run "hardware/GoPro/setup/" -p "GoPro_Quik-WinInstaller-2.5.2.633.exe" "" "" || return # https://shop.gopro.com/softwareandapp/quik-%7C-desktop/Quik-Desktop.html#
	run "hardware/GoPro/setup/" -p "FusionStudio_x64_111_2018-02-07.exe" "FusionStudio_Mac_Sierra_111_2018-02-07.dmg" "" || return # https://shop.gopro.com/softwareandapp/gopro-fusion-studio-app/fusion-studio.html

	echo "Updating icons..."
	mergeDir "$pp/GoPro" "$pp/Travel/Other" || return
	mergeDir "$up/GoPro Fusion Studio 1.1" "$pp/Travel/Other/GoPro" || return
	mergeDir "$up/GoPro VR Player 3.0" "$pp/Travel/Other/GoPro" || return
	$rm "$pd/GoPro Quik.lnk" || return
	$rm "$ud/GoPro Fusion Studio 1.1.lnk"	 || return
	$rm "$ud/GoPro VR Player 3.0.lnk"	 || return
}

Geekbench()
{
	printf "**************************************************\n* Geekbench\n**************************************************\n"
	
	# https://www.geekbench.com/
	local v=5.1.1
	run "shareware/Geekbench/" -p "Geekbench-$v-WindowsSetup.exe" "Geekbench-$v-Mac.zip" "Geekbench-$v-Linux.tar.gz" --elevate || return 

	if IsPlatform win; then
		echo "Updating icons..."
		$ren "$up/Geekbench 5/Geekbench 5.lnk" "$pp/Applications/Geekbench.lnk" || return
		$rmd "$up/Geekbench 5" || return
	fi

	return 0
}

dji()
{
	printf "**************************************************\n* DJI\n**************************************************\n"

	# https://www.dji.com/mavic/info#downloads
	run "hardware/dji/Assitant/setup/" -p "DJI Assistant 2 1.2.3.exe" "DJI+Assistant+2+1.2.3.pkg" "" || return

	mergeDir --rename "$up/DJI Product" "$pp/Travel/Other/DJI" || return
	mergeDir --rename "$pp/DJI Product" "$pp/Travel/Other/DJI" || return
	$rm "$pd/DJI Assistant 2.lnk" || return
}

OneDrive()
{
	echo "Configuring OneDrive..."

	SetVar --delete OneDrive || return
	SetVar --delete OneDriveConsumer || return

	$registry delete "urun/OneDrive" # "C:\Users\jjbutare\AppData\Local\Microsoft\OneDrive\OneDrive.exe" /background
	$registry delete "HKCU/SOFTWARE/Microsoft/Windows/CurrentVersion/Explorer/Desktop/NameSpace/{018D5C66-4533-4307-9B53-224DE2ED1FE6}/" # Desktop One Drive icon
	$registry set "HKCR/CLSID/{018D5C66-4533-4307-9B53-224DE2ED1FE6}/System.IsPinnedToNameSpaceTree" REG_DWORD 0 || return # Desktop One Drive icon

	$mv "$pp/OneDrive"*".lnk" "$pp/Applications/Accessories" || return
	$mv "$up/OneDrive"*".lnk" "$pp/Applications/Accessories" || return
}

tribler()
{
	printf "**************************************************\n* Tribler\n**************************************************\n"

	# https://www.tribler.org/
	run "shareware/tribler/Tribler_7.2.2_x64.exe" || return

	mergeDir "$pp/VideoLAN" "$pp/Media/Other" || return
	mergeDir "$up/Tribler" "$oo" || return
	$rm "$pd/VLC media player.lnk" || return
	$rm "$ud/Tribler.lnk" || return

		echot "\
- settings
	- Save files to=C:\Users\jjbutare\Downloads
	- uncheck Family filter / Download anonymously / Encrypted anonymous seeding"
}

TrueImage()
{
	printf "**************************************************\n* True Image\n**************************************************\n"

	# https://www.acronis.com/en-us/support/updates/index.html
	run "acronis/True Image/setup/AcronisTrueImage2019." -p "exe" "dmg" "" || return

	mergeDir "$pp/Acronis" "$oo" || return
	$rm "$pp/Acronis True Image.lnk" || return
	$rm "$pd/Acronis True Image.lnk" || return
	$registry delete "run/Acronis Scheduler2 Service" # C:\Program Files (x86)\Common Files\Acronis\Schedule2\schedhlp.exe
	$registry 32 delete "run/AcronisTibMounterMonitor" # C:\Program Files (x86)\Common Files\Acronis\TibMounter\TibMounterMonitor.exe
	$registry 32 delete "run/TrueImageMonitor.exe" # C:\Program Files (x86)\Acronis\TrueImageHome\TrueImageMonitor.exe

	echot "\
- Active Protection, off
- settings, Mobile backup location=d:\backup"
}

ToDoBackup()
{
	printf "**************************************************\n* ToDo Backup\n**************************************************\n"

	# https://www.easeus.com/backup-software/personal.html
	run "EaseUS/ToDo Backup Home/tbh_trial.exe" || return
	
	mergeDir --rename "$pp/EaseUS Todo Backup 11.5" "$oo/ToDo Backup" || return
	$rm "$pd/EaseUS Todo Backup Home 11.5.lnk" || return
}

TeraCopy()
{
	printf "**************************************************\n* TeraCopy\n**************************************************\n"
	run "Shareware/TeraCopy/teracopy.exe" || return # https://codesector.com/teracopy
}

ParagonExtFs()
{
	printf "**************************************************\n* Paragon ExtFS \n**************************************************\n"

	# http://www.paragon-drivers.com/extfs-windows/
	run "Paragon/ExtFS/Paragon-608-PEU_WinInstallSN-4.3.852.msi" || return
	
	mergeDir --rename "$pp/Paragon ExtFS for Windows" "$oo/Paragon ExtFS" || return
	$rm "$pd/Paragon ExtFS for Windows.lnk" || return

	service manual "ParagonMounter" || return # does not allow computer to sleep
}

BrotherPrinter()
{
	printf "**************************************************\n* Brother Printer \n**************************************************\n"
	echot "- Connection Type=Wired, check Custom Install
- Select Features=uncheck PC-FAX*"

	# https://support.brother.com/g/b/downloadtop.aspx?c=us&lang=en&prod=mfcl2740dw_us_eu_as
	run "hardware/Brother/MFC-L2740DW/setup/" -p "MFC-L2740DW-inst-C1-US.EXE" "MonoLaserFB14_ULW_TP_110.dmg" --pause || return
	
	if IsPlatform win; then	
		mergeDir "$pp/Brother" "$ao" || return
		$mv "$pd/Brother Creative Center.lnk" "$ao/Brother" || return
		$rm "$pd/Brother Utilities.lnk" || return
		$registry 32 delete "RunOnce/BrUrl" || return # rundll32 url.dll,FileProtocolHandler http://www.brother.com/rd/productreserch/usa/
		$registry 32 delete "RunOnce/OmniJoinURL" || return # C:\Program Files (x86)\Brother\Brmfl14d\OmniJoinTrial.exe /R
		$registry 32 delete "run/BrStsMon00" # C:\Program Files (x86)\Browny02\Brother\BrStMonW.exe /AUTORUN
		$registry 32 delete "run/ControlCenter4" # C:\Program Files (x86)\ControlCenter4\BrCcBoot.exe /autorun
	fi

	return 0
}

PowerPanel()
{
	printf "**************************************************\n* PowerPanel \n**************************************************\n"
	
	# https://www.cyberpower.com/hk/en/software
	run "hardware/CyberPower/PowerPanel/setup/PPP_Windows_v2.2.1.exe" || return

	mergeDir "$pp/CyberPower PowerPanel Personal" "$oo" || return
	$rm "$pp/Startup/PowerPanel Personal.exe.lnk" || return # "C:\Program Files (x86)\CyberPower PowerPanel Personal\PowerPanel Personal.exe"
	$rm "$pp/Startup/ppuser.exe.lnk" || return # "C:\Program Files (x86)\CyberPower PowerPanel Personal\bin\ppuser.exe"
}

LgMonitor()
{
	printf "**************************************************\n* LG Monitor\n**************************************************\n"

	run "hardware/LG/Gaming Monitor 34UC89G/OSC2_Setup_2-86.exe" || return

	mergeDir "$pp/OnScreen Control" "$oo" || return
	$rm "$pd/OnScreen Control.lnk" || return
}

DasKeyboard()
{
	printf "**************************************************\n* Das Keyboard\n**************************************************\n"

	# https://www.daskeyboard.io/get-started/
	run "hardware/Das Keyboard/setup/" -p "Das-Keyboard-Q_3.2.4.exe" "q-Desktop.img" || return

	if IsPlatform win; then	
		mergeDir "$pp/Das-Keyboard-Q" "$oo" || return
		$rm "$ud/das-keyboard-q.lnk" || return
		$rmd "$up/GitHub, Inc" || return
		$registry 32 delete "run/Das Keyboard Q" || return # C:\Users\jjbutare\AppData\Local\das-keyboard-q\das-keyboard-q.exe
	fi
}

UniFiController()
{
	[[ ! -d "$P32/Java" ]] && { jreInstall || return; }

	printf "**************************************************\n* UniFi Controller\n**************************************************\n"

	# https://www.ui.com/download/unifi
	run "hardware/Ubiquiti Networks/UniFi/controller/" -p "UniFi-installer.exe" "UniFi.pkg" "BZ.ar934x.v3.9.27.8537.180317.1223.bin" || return
	
	if [[ "$PLATFORM" == "win" ]]; then	

		echo "Updating icons..."
		mergeDir "$up/Ubiquiti UniFi" "$oo" || return
		$rm "$ud/UniFi.lnk" || return		

		echo "Moving data folders..."
		MakeLink --merge --hide "$udata/Unifi Controller" "$WIN_HOME/Ubiquiti UniFi" || return

	fi

	return 0
}

NordVpn()
{
	[[ "$PLATFORM" != "win" ]] && return 0;

	printf "**************************************************\n* NordVPN\n**************************************************\n"

	# https://nordvpn.com/download/
	run "NordVPN/" -p "NordVPNSetup.exe" "mac" "linux" || return

	if [[ "$PLATFORM" == "win" ]]; then	
		$rmd "$pp/NordVPN" || return
		mv "$pd/NordVPN.lnk" "$pp/Applications" || return
		$registry 32 delete "urun/NordVPN" || return # C:\Program Files (x86)\NordVPN\NordVPN.exe
	fi
}

CleanMyPc()
{
	printf "**************************************************\n* Clean My PC\n**************************************************\n"
	
	# https://macpaw.com
	run "MacPaw/Clean My/" -p "CleanMyPC.exe" "CleanMyMacX.dmg" --pause # returns error even if the setup is successful

	if IsPlatform mac; then
		MacAppConfigure "CleanMyMac X" || return
	elif IsPlatform win; then
		mergeDir "$pp/CleanMyPC" "$oo" || return
		$rm "$pd/CleanMyPC.lnk" || return
	fi

	return 0
}

CloseAllWindows()
{
	printf "**************************************************\n* Close All Windows\n**************************************************\n"

	# https://www.ntwind.com/software/closeall.html
	run "NTwind/CloseAll_4.8-setup.exe" --elevate || return

	echo "Updating icons..."
	mergeDir "$pp/CloseAll" "$oo" || return
	$rm "$pd/CloseAll.lnk" || return
}

AltTabTerminator()
{
	printf "**************************************************\n* Alt-Tab Terminator\n**************************************************\n"
	
	# https://www.ntwind.com/software/alttabter.html
	run "NTwind/AltTabTer_4.8-setup.exe" --elevate || return

	mergeDir "$pp/Alt-Tab Terminator" "$oo" || return
	$rm "$pd/Alt-Tab Terminator.lnk" || return
	$registry delete "urun/Alt-Tab Terminator" # "C:\Program Files\Alt-Tab Terminator\AltTabTer64.exe" /startup

	echot "\Settings...
- Uncheck Autostart on Windows startup
- Hamburger, check Replace Alt-Tab, uncheck Replace Win-Tab"
	app AltTabTerminator || return
}

HiddenStart()
{
	printf "**************************************************\n* Hidden Start\n**************************************************\n"

	# https://www.ntwind.com/software/hstart.html
	run "NTwind/Hstart_4.7-setup.exe" --elevate || return 

	mergeDir "$pp/Hidden Start" "$oo" || return
	$rm "$pd/Hidden Start.lnk" || return

	HiddenStartFinal || return
}

HiddenStartFinal()
{
	echo "Adding license..."
	if [[ ! "$(registry 32 get "HKLM/SOFTWARE/Alexander Avdonin/Hidden Start/RegName")" ]]; then
			registry import "$setupFiles/HiddenStart.reg" || return
			pause
	fi

	echo "Adding scheduled task..."
	if ! schtasks.exe | egrep HstartUAC-x64 >& /dev/null; then
		start --wait hstart64.exe /nouac /wait ""cmd" /c echo Hidden Start 64 scheduled task is setup && pause"
	fi

	return 0
}

QuickenInstall()
{
	printf "**************************************************\n* Quicken\n**************************************************\n"

	# https://www.quicken.com/activate
	run "Quicken/" -p "Quicken.exe" "Quicken.dmg" "" --elevate || return

	mergeDir --rename "$pp/Quicken" "$ao/Quicken"
	$rm "$pd/Quicken.lnk" || return
}

QuickBooks()
{
	printf "**************************************************\n* Quick Books\n**************************************************\n"

	run "Intuit/QuickBooks-Setup.exe" || return

	$mv "$ud/QuickBooks.lnk" "$pp/Applications" || return
	$mv "$up/QuickBooks.lnk" "$pp/Applications" || return
}

AxCrypt()
{
	printf "**************************************************\n* AxCrypt\n**************************************************\n"
	run "AxCrypt/setup/" -p "AxCrypt-2.1.1573.0-Setup.exe" "AxCrypt-Mac-2.2.578.0.pkg" "linux" || return # https://www.axcrypt.net/download/

	if IsPlatform win; then	
		mergeDir "$pp/AxCrypt" "$oo" || return
		makeLink --merge --hide "$udata/AxCrypt" "$udoc/My AxCrypt" || return
		makeLink --merge --hide "$uhome/DropBox/data/AxCrypt" "$uhome/DropBox/My AxCrypt" || return
		makeLink --merge --hide "$uhome/OneDrive/documents/data/AxCrypt" "$uhome/OneDrive/My AxCrypt" || return
	fi

	return 0
}

TaskLayout()
{
	printf "**************************************************\n* TaskLayout\n**************************************************\n"

	# http://www.systemgoods.com/
	run "SystemGoods/TaskLayout-v0.7.0.5-Installer.exe" || return
}

vlc()
{
	printf "**************************************************\n* VLC Media Player\n**************************************************\n"

	# https://www.videolan.org/vlc/
	run "VideoLAN/" -p "vlc-3.0.4-win64.exe" "mac" "linux" || return

	if IsPlatform win; then	
		echo "Updating icons..."
		mergeDir "$pp/VideoLAN" "$pp/Media/Other" || return
		$rm "$pd/VLC media player.lnk" || return
	fi

	return 0
}

StandardNotes()
{
	printf "**************************************************\n* Standard Notes\n**************************************************\n"

	local v="3.0.19" # https://standardnotes.org/
	run "Shareware/Standard Notes/" -p "standard-notes-setup-$v.exe" "standard-notes-$v-mac.zip" "standard-notes-$v-x86_64.AppImage" || return

	if IsPlatform linux; then
		cp "$InstallDir/Shareware/Standard Notes/appimagekit-standard-notes.desktop" ~/.local/share/applications || return
	elif IsPlatform mac; then
		MacAppConfigure "Standard Notes" || return
	elif IsPlatform win; then
		$mv "$ud/Standard Notes.lnk" "$up/Applications" || return
		$rm "$up/Standard Notes.lnk" || return
		makeDir "$udata/app/Standard Notes" || return
		makeLink --merge --hide "$udata/app/Standard Notes/backups" "$WIN_HOME/Standard Notes Backups" || return
	fi

	return 0
}

AmcrestCamera()
{
	printf "**************************************************\n* Amcrest Camera\n**************************************************\n"

	# https://support.amcrest.com/hc/en-us/categories/201939038-All-Downloads
	run "hardware/Amcrest/setup/" -p "Amcrest_ConfigTool_Eng_V3.20.10.T.180715.exe" "Amcrest IP Config.zip" "" --elevate || return 
	run "hardware/Amcrest/setup/" -p "P2PSurveillance_3.01.001.0.exe" "" "" --elevate || return # browser plugin
	run "hardware/Amcrest/setup/" -p "Amcrest+Surveillance+Pro+Setup+V1.14.1.R.20161018.exe" "Amcrest_Surveillance_Pro_Mac.bz2" "" --elevate || return

	if IsPlatform win; then	
		makeDir "$pp/Surveillance/Other" || return
		mv "$pd/Amcrest IP Config.lnk" "$pp/Surveillance" || return
		mv "$pd/Amcrest Surveillance Pro.lnk" "$pp/Surveillance" || return
		$rmd "$pp/Amcrest IP Config" || return
		$rmd "$pp/Amcrest Surveillance Pro" || return
	fi

	return 0
}

SurveillanceStation()
{
	printf "**************************************************\n* 4 Station\n**************************************************\n"
	run "hardware/Synology/Surveillance Station/" -p "Synology Surveillance Station Client-1.2.2-0589_x64.exe" "Synology Surveillance Station Client-1.2.2-0589.dmg" "linux" || return # https://www.synology.com/en-us/support/download/DS216+II?item_filter= x#utilities

	if IsPlatform win; then	
		echo "Updating icons..."
		mergeDir "$pp/Synology" "$pp/Surveillance/Other" || return
		$rm "$pd/Live View.lnk" || return
		$rm "$pd/Surveillance Station Client.lnk" || return
		$rm "$pd/Timeline.lnk" || return
	fi

	return 0
}

plex()
{
	printf "**************************************************\n* PLEX\n**************************************************\n"

	# https://www.plex.tv/media-server-downloads/
	run "PLEX/" -p "Plex-1.6.3.1009-57cf57c8-x86_64.exe" "Plex-1.11.0.1215-1d8c460c-x86_64.zip" || return 
	run "PLEX/" -p "PlexMediaServer-1.18.8.2468-5d395aa9d-x86.exe" "PlexMediaServer-1.18.8.2468-5d395aa9d-x86_64.zip" "plexmediaserver_1.18.8.2468-5d395aa9d_amd64.deb" || return

	if [[ "$PLATFORM" == "win" ]]; then
		mergeDir "$pp/Plex" "$pp/Media/Other" || return
	fi

	return 0
}

oculus()
{
	printf "**************************************************\n* Oculus\n**************************************************\n"


	# https://www.oculus.com/setup/
	run "hardware/oculus/" -p "OculusSetup.exe" "mac" "linux" --elevate || return

	if [[ "$PLATFORM" == "win" ]]; then	
		$mv "$pd/Oculus.lnk" "$pp/Game" || return
		mergeDir "$psm/Oculus" "$pp/Game/Other" || return
		makeLink --merge --hide "$udata/app/Oculus" "$udoc/Oculus Home" || return
	fi

	return 0
}

LinkShellExtension()
{
	printf "**************************************************\n* Link Shell Extension\n**************************************************\n"

 	# http://schinagl.priv.at/nt/hardlinkshellext/hardlinkshellext.htm	
	run "Shareware/Link Shell Extension/" -p "HardLinkShellExt_X64.exe" "mac" "linux" || return

	if IsPlatform win; then	
		mergeDir "$up/Link Shell Extension" "$oo" || return
	fi

	return 0
}

RightClickEnhancer()
{
	printf "**************************************************\n* Right Click Enhancer\n**************************************************\n"
	
	# https://rbsoft.org/downloads/right-click-enhancer/
	run "RBSoft/Right Click Enhancer/Right.Click.Enhancer.Professional.Setup.exe" --elevate || return

	mergeDir "$up/Right Click Enhancer Professional" "$oo" || return
	$rm "$ud/Right Click Enhancer Professional.lnk" || return	

	echot "\
Setup
- Registration, Registration
- Right Click Editor, Action, Install Customize this Menu
Definitions
- normal entries - static entries, normally no submenus or icons
- shell extensions - dynamic entries (from a DLL) , typically shown with an icon
Instructions
- shift-right-click - view hidden items
- shift-right-click, Customize this Menu - customize the right click menu which 
  shows all normal and shell extensions fo the selected object together
- Right Click Editor, click top-left picture to toggle between normal entries and shell extensions
- EPP is Windows Defender, mscore (.NET programs)"
}


be() { BalenaEtcher; }; etcher() { BalenaEtcher; }
BalenaEtcher() # disc image burner
{
	printf "**************************************************\n* Balena Etcher\n**************************************************\n"

	# https://www.balena.io/etcher/
	local v="1.5.79" 
	run "Balena/Etcher/" -p "balenaEtcher-Setup-$v.exe" "balenaEtcher-$v.dmg" "balena-etcher-electron-$v-linux-x64.zip" || return

	if IsPlatform win; then
		$mv "$up/balenaEtcher.lnk" "$up/Applications" || return
		$rm "$ud/balenaEtcher.lnk" || return	
	fi

	return 0
}

DockerInstall()
{
	printf "**************************************************\n* Docker\n**************************************************\n"

	# https://hub.docker.com/editions/community/docker-ce-desktop-windows
	run "Shareware/Docker/" -p "Docker for Windows Installer.exe" || return

	if IsPlatform win; then	
		$mv "$ud/Docker Desktop.lnk" "$pp/Operating System" || return
	fi

	return 0
}

xServer()
{
	printf "**************************************************\n* X Server\n**************************************************\n"
	RunPlatform xServer || return
}

xServerMac() { xQuartzInstall || return; }

xServerWin() 
{ 
	xMingInstall || return
	$makeShortcut "wscript.exe" "$pp/Operating System/terminator" "$(utw "$DATA/platform/win")\terminator.vbs" "$(utw "$DATA/icons/terminator2.ico")" || return
}

vcxsrvInstall()
{
	# https://sourceforge.net/projects/vcxsrv/
	run "LINUX/VcXsrv/vcxsrv-64.1.20.1.4.installer.exe" --pause || return

	mergeDir "$pp/VcXsrv" "$oo" || return
}

xMingInstall()
{
	# http://www.straightrunning.com/XmingNotes/ http://www.straightrunning.com/candidate/
	run "LINUX/Xming/rel_x64_Xming-7-7-0-54-setup.exe" || return
	run "LINUX/Xming/Xming-fonts-7-7-0-10-setup.exe" || return

	mergeDir "$pp/Xming" "$oo" || return
	$rm "$pd/XLaunch.lnk" || return
	$hide "$WIN_HOME/Xdefaults" || return
}

xQuartzInstall()
{
	# https://www.xquartz.org/ 
	run "LINUX/XQuartz/XQuartz-2.7.11.dmg" || return

	echot "\
- Preferences, Security, check Allow connections from network clients"
	MacAppConfigure XQuartz || return

	if askP 'Test XQuartz'; then
		export DISPLAY=:0
		/opt/X11/bin/xclock
	fi

	return 0
}

homebridge()
{
	local plugins="homebridge-neato homebridge-vera homebridge-webos-tv"

	printf "**************************************************\n* Homebridge\n**************************************************\n"

	! nodeInstalled && { i nodejs || return; }
	
	if ! InPath homebridge; then
		echo "Installing homebridge..."
		sudo npm install -g --unsafe-perm homebridge homebridge-config-ui-x homebridge-script homebridge-wol || return
	fi

	packages g++ gcc make python || return

	RunPlatform homebridge || return

	ask "Install other packages" && { sudo npm install -g $plugins || return; }
	
	return 0
}

homebridgeRaspbian()
{
	if ! [[ -f /etc/systemd/system/homebridge.service ]]; then
		sudo hb-service install --user homebridge || return
	fi

	if ! [[ -e ~/.homebridge ]]; then
		echo "Linking /var/lib/homebridge to ~/.homebridge to enable $USER to run homebridge from the command line..."
		ln -s -T /var/lib/homebridge ~/.homebridge
	fi

	if ask "Configuring Wake On Lan plugin"; then
		InPath setcap && { sudo setcap cap_net_raw=pe /usr/bin/node || return; }
		[[ -f /sbin/shutdown ]] && { sudo chmod +s /sbin/shutdown || return; }
	fi

	if ! grep "/usr/local/data/bin" /etc/default/homebridge >& /dev/null && ask "Configuring SSH plugin"; then
		printf "\n"'PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/data/bin"'"\n" | sudo tee -a /etc/default/homebridge
	fi

	if ask "Change homebridge password"; then
		sudo passwd homebridge || return
	fi
	
	if [[ ! -d ~homebridge/.ssh ]] && ask 'Enable passwordless ssh for homebridge account (for homebridge-ssh and homebridge-script)'; then
		sudo mkdir ~homebridge/.ssh || return

		sudo cp ~/.ssh/config ~/.ssh/known_hosts ~homebridge/.ssh || return
		sudo chown homebridge ~homebridge/.ssh/config ~homebridge/.ssh/known_hosts || return

		sudo ~/.ssh/id_ed25519 ~/.ssh/id_rsa ~homebridge/.ssh || return
		sudo chown homebridge ~homebridge/.ssh/known_hosts ~homebridge/.ssh/id_ed25519 ~homebridge/.ssh/id_rsa || return
		sudo ssh-keygen -p -N '' -f ~homebridge/.ssh/id_ed25519 || return
		sudo ssh-keygen -p -N '' -f ~homebridge/.ssh/id_rsa || return

		# test ssh connection
		su homebridge -c 'ssh '$USER'@'$HOSTNAME' ls > /dev/null' || return
	fi

	return 0
}

NodeRed()
{
	printf "**************************************************\n* node-red\n**************************************************\n"
	! nodeInstalled && { i nodejs || return; }
	
	if ! InPath node-red; then
		echo "Installing node-red..."
		bash <(curl -sL https://raw.githubusercontent.com/node-red/raspbian-deb-package/master/resources/update-nodejs-and-nodered) || return
	fi

	sudo systemctl enable nodered.service || return

	return 0
}

DiskImager()
{
	printf "**************************************************\n* Disk Imager \n**************************************************\n"
	run "Shareware/other/win32diskimager-1.0.0-install.exe" || return # http://www.paragon-drivers.com/extfs-windows/

	echo "Updating icons..."
	mergeDir "$pp/Image Writer" "$oo" || return
}

Discord()
{
	printf "**************************************************\n* Discord\n**************************************************\n"

	# https://discordapp.com/download
	run "Discord/" -p "DiscordSetup.exe" "Discord.dmg" "discord-0.0.9.deb" || return
	
	mergeDir "$up/Discord Inc" "$up/Applications/Other" || return
	$rm "$ud/Discord.lnk" || return
	$registry delete "urun/Discord" # C:\Users\jjbutare\AppData\Local\Discord\app-0.0.305\Discord.exe --start-minimized
}

Todoist()
{
	printf "**************************************************\n* Todoist\n**************************************************\n"

	# https://todoist.com/downloads/
	run "Todoist/Todoist_for_Windows_Desktop_2_7_6.exe" || return
		
	mergeDir "$up/Todoist" "$up/Applications/Other" || return
	$rm "$ud/Todoist.lnk" || return
}

iTerm()
{
	printf "**************************************************\n* iTerm\n**************************************************\n"
	
	# https://iterm2.com/downloads.html
	run "macOS/iTerm2/iTerm2-3_3_10.zip" || return

	if ask "Do you want to install iTerm shell integration"; then # https://iterm2.com/documentation-shell-integration.html
		curl -L https://iterm2.com/shell_integration/install_shell_integration_and_utilities.sh | bash
	fi

	echo "- Preferences, General, Preferences, check Load preferences from a custom folder or URL=<paste>"
	clipw "$udata/profile/default" || return
	MacAppOpen iTerm || return
}

apptivate()
{
	printf "**************************************************\n* Apptivate\n**************************************************\n"

	# http://www.apptivateapp.com
	run "macOS/Apptivate/Apptivate.app.zip" || return

	if askP "Do you want to configure apptivate"; then
		echot "Add Item...
- iTerm, ctrl-cmd-3
- Firefox, ctrl-cmd-a
- Standard Notes, ctrl-cmd-n
- Sublime Text, ctrl-cmd-t"
		MacAppOpen Apptivate || return
	fi

	return 0
}

bartender()
{
	printf "**************************************************\n* Bartender\n**************************************************\n"

	# https://www.macbartender.com/
	run "macOS/Bartender/Bartender 3.zip" || return

	echot "- Clock User Dropbox VPN CleanMyMac Battery Bartender Notifications"
	MacAppOpen "Bartender 3" || return
}

# Windows Store
Wallpaper4k() { StoreInstall "Wallpaper 4K" "9PMS2CJBHCKJ"; }

# Mac Store
CarrotWeather() { StoreInstall "CARROTweather" 993487541; }
DayOne() { StoreInstall "Day One" 1055511498; }
LiveDesktop() { StoreInstall "LiveDesktop" 846060286; }
Magnet() { StoreInstall "Magnet" 441258766; }
pcalc() { StoreInstall "PCalc" 403504866; }
spark() { StoreInstall Spark 1176895641; }
speedtest() { StoreInstall Speedtest 1153157709; }
WallpaperWizard() { StoreInstall "Wallpaper Wizard" 1266674560; }
yoink() { StoreInstall Yoink 457622435; }

zsh()
{
	local files=(.zshrc)
	for file in "${files[@]}"; do
		makeLink --symbolic --hide "$UBIN/$file" "$HOME/$file" || return
	done

	package zsh || return

	if ask 'Install Oh My ZSH'; then # https://ohmyz.sh/
		sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)" || return
	fi

	return 0
}

VirtualBoxCheck()
{
	if [[ ! -f "$P/Oracle/VirtualBox/VirtualBox.exe" ]] && ask "Do you want to install VirtualBox"; then
		VirtualBoxInstall; return
	fi
	return 0
}

VirtualBoxInstall()
{
	printf "**************************************************\n* VirtualBox\n**************************************************\n"

	local v="6.0.12-133076"	# https://www.virtualbox.org/wiki/Downloads
	run "Shareware/VirtualBox/setup/" -p "VirtualBox-$v-Win.exe" "VirtualBox-$v-OSX.dmg" "virtualbox-$v~Ubuntu~bionic_amd64.deb" || return
	ask 'Install VirtualBox extension pack' && { start "$InstallDir/Shareware/VirtualBox/extension/Oracle_VM_VirtualBox_Extension_Pack-6.0.12.vbox-extpack" || return; }

	if IsPlatform win; then	
		mergeDir "$pp/Oracle VM VirtualBox" "$oo" || return
		$rm "$pd/Oracle VM VirtualBox.lnk" || return
		$hide "$WIN_HOME/.VirtualBox" || return
		makeLink --merge --hide "$udata/app/VirtualBox" "$WIN_HOME/VirtualBox VMs" || return
	fi

	return 0
}

BlueStacksInstall()
{
	printf "**************************************************\n* BlueStacks\n**************************************************\n"

	# https://www.bluestacks.com/
	run "game/BlueStacks/BlueStacksInstaller_4.120.5.1101_native_dd8ed79ebd104260f66cb75de271e11b.exe" || return

	makeDir "$pp/Game/Other/BlueStacks" || return
	$mv "$pp/BlueStacks.lnk" "$pp/Game/Other/BlueStacks" || return
	$mv "$pp/BlueStacks Multi-Instance Manager.lnk" "$pp/Game/Other/BlueStacks" || return
	$rm "$pd/BlueStacks Multi-Instance Manager.lnk" "$pd/BlueStacks.lnk" || return
}

JetBrains()
{
	printf "**************************************************\n* JetBrains\n**************************************************\n"
	
	local v="1.16.6067" # https://www.jetbrains.com/toolbox-app/
	run "JetBrains/toolbox/jetbrains-toolbox-$v." -p "exe" "dmg" "tar.gz" || return

	if IsPlatform win; then
		echo "Updating icons..."
		mergeDir "$up/JetBrains Toolbox" "$up/Development/other" || return
		mergeDir "$up/JetBrains" "$up/Development/other" || return
	fi

	if ask "Restore ReSharper profile"; then
		ReSharper profile restore default || return
	elif ask 'Configure ReSharper manually'; then
		echot "\
- ReSharper, Options
	- Keyboards & Menus, ReSharper keyboard scheme=ReSharper 2.x or IntelliJ IDEA, Apply Scheme
	- Environment, Editor, Editor Behavior, uncheck Use CamelHumps
	- Environment, IntelliSense
		- Autopopup, C#, Where value is expected, Do not display
		- Completion Appearance, check Show Member Signatures and Show Summary
	- Code Editing
			- Code Cleanup, Add, default
			- Check all except Embrace 'using' directives in region and Apply code body style
	- C#, Formattign Style
		- Blank Lines, Keep max blank lines=1 (2 places)
		- Line Breaks and Wrapping, Other, check Place simple method on single line
	- Tools
		- Unit Testing
			- Run up to 4 assemblies in parallel
			- Uncheck Save and restore Unit Test Sessions
			- Uncheck Wrap long lines in Unit Test Session output
		- External Sources=Navigation to Sources, check all
- Customize Keyboard (ctrl-shift-alt-k)
	- ReSharper.ReShartper_DuplicateText, Remove, Remove (free ctrl-d)
- notes: ctrl-n, <class>, click object, ctrl-b, Navigate to Decompiled Sources"
		VisualStudio start
	fi

	return 0
}

JumpCloud()
{
	printf "**************************************************\n* JumpCloud\n**************************************************\n"

	# https://console.jumpcloud.com/#/systems/new
	local key="d55d2d17f6fdc877905cf7dd798e7c910948eff3"

	if IsPlatform mac,win; then
		echo "connect key=<paste> ($key)"; clipw "$key"
		run "JumpCloud/setup/" -p "JumpCloudInstaller.exe" "jumpcloud-agent.pkg" "" || return
	elif IsPlatform ubuntu; then
		curl --tlsv1.2 --silent --show-error --header "x-connect-key: $key" https://kickstart.jumpcloud.com/Kickstart | sudo bash
	fi

	return 0
}

NiniteInstall()
{	
	printf "**************************************************\n* Ninite\n**************************************************\n"

	# https://ninite.com/agent.exe
	run "Ninite/Ninite Agent Installer.exe" --elevate --no-pause /silent || return
}

DomotzInstall()
{
	printf "**************************************************\n* Domotz\n**************************************************\n"

	# https://portal.domotz.com/portal/web_app
	local v="1.1.2" # http://www.techsmith.com/download/licenses/snagitupgrade.asp
	run "Domotz/Domotz Pro Desktop App " -p "Setup $v" "-$v.dmg" "" || return

	if IsPlatform win; then
		$mv "$pp/Domotz Pro Desktop App.lnk" "$pp/Operating System" || return
		$rm "$pd/Domotz Pro Desktop App.lnk" || return
	fi

	return 0
}

CricutInstall()
{
	printf "**************************************************\n* Cricut\n**************************************************\n"

	# https://design-beta2.cricut.com/#/download
	local v="5.2.14" 
	run "hardware/Cricut/Cricut Design Space Install v$v." -p "exe" "mac" "" || return

	if IsPlatform win; then
		$registry delete "run/ErmTray" # C:/Program Files/McAfee/Host Intrusion Prevention/FireTray.exe 
		mergeDir "$up/Cricut Design Space Beta" "$up/Applications/other" || return
		$mv "$ud/Cricut Design Space.lnk" "$up/Applications" || return 
		$mv "$ud/Cricut Design Space Beta.lnk" "$up/Applications" || return
		$rm "$up/Startup/Cricut Taskbar Application.lnk" || return # "C:\Users\jjbutare\AppData\Roaming\Cricut Design Space\Web\taskbar-application-win32\Release\CricutTaskbarApplication.exe"
	fi

	return 0
}

FileLocatorProInstall()
{
	printf "**************************************************\n* FileLocator Pro\n**************************************************\n"

	# https://www.mythicsoft.com/filelocatorpro/download/
	local v="2944" 
	run "Mythicsoft/FileLocator Pro/setup/filelocator_x64_$v.msi" || return

	if [[ "$PLATFORM" == "win" ]]; then
		mergeDir "$pp/FileLocator Pro" "$oo" || return
	fi

	return 0
}

UltraMonInstall()
{
	printf "**************************************************\n* UltraMon\n**************************************************\n"

	# https://www.realtimesoft.com/ultramon/download.asp
	run "other/UltraMon/UltraMon_3.4.1_en_x64.msi" || return

	if [[ "$PLATFORM" == "win" ]]; then
		$mv "$pp/UltraMon.lnk" "$pp/Applications" || return
		$rm "$pp/Startup/UltraMon.lnk" || return
	fi

	return 0
}

Karabiner() { KarabinerElementsInstall; }
KarabinerElementsInstall()
{
	printf "**************************************************\n* Karabiner-Elements\n**************************************************\n"

	# https://pqrs.org/osx/karabiner/
	run "macOS/Karabiner-Elements/Karabiner-Elements-12.9.0.dmg" || return

	MacAppOpen Karabiner-Elements || return

	return 0
}

NotionInstall()
{
	printf "**************************************************\n* Notion\n**************************************************\n"

	# https://www.notion.so/desktop
	run "Notion/" -p "Notion Setup 2.0.8.exe" "Notion-2.0.7.dmg" || return

	if IsPlatform win; then
		$mv "$up/Notion.lnk" "$up/Applications" || return
		$rm "$ud/Notion.lnk" || return
	
	elif IsPlatform mac; then
		MakeDirOwner "$P/Notion.app" || return # must be writable otherwise prompted for invalid install
	fi

	return 0
}

SkypeInstall()
{
	printf "**************************************************\n* Skype\n**************************************************\n"

	# https://www.skype.com/en/get-skype/
	run "Microsoft/Skype/" -p "Skype-8.59.0.77.exe" "Skype-8.59.0.77.dmg" "skypeforlinux-64.deb" || return

	IsPlatform win && { SkypeIcons || return; }

	return 0
}

SkypeIcons()
{
	mergeDir "$pp/Skype" "$pp/Applications/Other" || return
	$rm "$pp/"Skype*.lnk || return
	$rm "$pd/Skype.lnk" || return
	$registry delete "urun/Skype for Desktop" # C:\Program Files (x86)\Microsoft\Skype for Desktop\Skype.exe
}

ZoomInstall()
{
	printf "**************************************************\n* Zoom\n**************************************************\n"

	# https://zoom.us/support/download
	run "Zoom/" -p "ZoomInstallerFull.msi" "ZoomInstallOnly.pkg" --pause || return

	if IsPlatform win; then
		mergeDir "$pp/Zoom" "$pp/Applications/Other" || return
		$rm "$pd/Zoom.lnk" || return
		$rm "$ud/Zoom.lnk" || return
	fi

	return 0
}

stamps()
{
	printf "**************************************************\n* Stamps.com\n**************************************************\n"

	run "other/stamps/Stamps.com.Connect.exe" --elevate || return

	if IsPlatform win; then
		$registry 32 delete "run/Stamps.com" # C:\Program Files (x86)\Stamps.com Connect\StampsPlugin.exe a
		mergeDir "$pp/Stamps.com Connect" "$pp/Applications/Other" || return
		$rm "$pd/Launch Stamps.com Connect.lnk" || return
	fi

	return 0
}

AjaSystemTest()
{
	printf "**************************************************\n* AJA System Test\n**************************************************\n"

	run "Shareware/AJA System Test/" -p "AJA_SystemTest_12.5.0.msi" "" "" || return

	if IsPlatform win; then
		mergeDir "$pp/AJA" "$oo" || return
	fi

	return 0
}

JumpDesktopInstall()
{
	printf "**************************************************\n* Jump Desktop\n**************************************************\n"

	# https://app.jumpdesktop.com/dashboard
	run "JumpDesktop/" -p "JumpDesktop.exe" "JumpDesktopMac.zip" || return

	if IsPlatform win; then
		makeDir "$oo/Jump Desktop" || return
		$mv "$pp/Jump Desktop.lnk" "$oo/Jump Desktop" || return
		$mv "$pp/Jump Desktop Connect.lnk" "$pp/Operating System/other/Jump Desktop" || return
	fi

	return 0
}

PowerToysInstall()
{
	printf "**************************************************\n* PowerToys\n**************************************************\n"

	# https://github.com/microsoft/PowerToys
	run "Microsoft/Windows/other/PowerToysSetup-0.16.1-x64.msi" || return

	if IsPlatform win; then
		$ren "$pp/PowerToys (Preview).lnk" "$pp/Operating System/Power Toys.lnk" || return
	fi

	return 0
}

qvrInstall()
{
	printf "**************************************************\n* QVR (QNAP Video Recorder)\n**************************************************\n"

	# https://www.qnap.com/en/download?model=tvs-471&category=firmware
	run "hardware/QNAP/QVR/" -p "QVRProClient.exe" "QVRMacClient-2.2.1-170221.dmg" || return

	if IsPlatform win; then
		mergeDir "$pp/QNAP" "$pp/Surveillance/Other" || return
		$mv "$ud/QVR Pro Client.lnk" "$pp/Surveillance/Other/QNAP/QVR Pro Client" || return
	fi

	return 0
}

deezerInstall()
{
	printf "**************************************************\n* Deezer\n**************************************************\n"
	IsPlatform win && run "9NBLGGH6J7VV" || run "Deezer/DeezerDesktop_4.18.60.dmg"
	return
}

CpuzInstall()
{
	printf "**************************************************\n* CPU-Z\n**************************************************\n"

	# https://www.cpuid.com/softwares/cpu-z.html
	run "CPUID/cpu-z_1.92-en.exe" || return

	if IsPlatform win; then
		mergeDir "$pp/CPUID" "$oo" || return
		$rm "$pd/CPUID CPU-Z.lnk" || return
	fi

	return 0
}

IntelExtremeTuningInstall()
{
	printf "**************************************************\n* Intel Extreme Tuning\n**************************************************\n"

	# https://downloadcenter.intel.com/download/24075/Intel-Extreme-Tuning-Utility-Intel-XTU
	run "Intel/Exteme Tuning Utility/XTUSetup Software.exe" --elevate || return

	if IsPlatform win; then
		mergeDir "$pp/Intel" "$oo" || return
		$rm "$pd/Intel(R) Extreme Tuning Utility.lnk" || return
	fi

	return 0
}

QnapExternalRaidManagerInstall()
{
	printf "**************************************************\n* QNAP External RAID Manager\n**************************************************\n"

	# https://www.qnap.com/en/utilities/essentials
	run "hardware/QNAP/Expansion Bay/setup/" -p "QNAPExternalRAIDManagerWindows-1.3.5.0309.exe" "QNAPExternalRAIDManagerMac-1.2.4.1202.dmg" || return

	if IsPlatform win; then
		mergeDir "$pp/QNAP" "$oo" || return
		$rm "$pd/QNAP External RAID Manager.lnk" || return
	fi

	return 0
}

CanonCameraInstall()
{
	printf "**************************************************\n* Canon Camera\n**************************************************\n"

	# https://www.usa.canon.com/internet/portal/us/home/support/details/cameras/eos-dslr-and-mirrorless-cameras/mirrorless/eos-r?tab=drivers_downloads
	local d="hardware/Canon/EOS R/setup"
	run "$d/EOS Utility v3.12.10." -p "exe" "zip" || return

	if IsPlatform win; then
		mergeDir "$pp/Canon Utilities" "$pp/Media/Other" || return
		$rm "$pd/EOS Utility.lnk" || return
		$rm "$pp/Startup/EOS Utility.lnk" || return # "C:\Program Files (x86)\Canon\EOS Utility\EOS Utility.exe" /AutoStartUp
	fi

	return 0
}

TeamViewerInstall()
{
	printf "**************************************************\n* TeamViewer\n**************************************************\n"

	# https://www.teamviewer.com/en/download/
	run "TeamViewer/" -p "TeamViewer_Setup.exe" "TeamViewer.dmg" "teamviewer_15.5.3_amd64.deb" || return

	if [[ "$PLATFORM" == "win" ]]; then
		$mv "$pp/TeamViewer.lnk" "$oo" || return
		$rm "$pd/TeamViewer.lnk" || return
	fi

	return 0
}

args "$@"; ${command}Command "${args[@]}";
